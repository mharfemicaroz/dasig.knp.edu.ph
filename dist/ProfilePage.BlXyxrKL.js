import{u as le,c as m,s as oe,r as p,o as re,z as K,B as q,b as l,m as A,p as ne,E as ie,g as H,a as o,F as N,f as e,h as _,t as n,e as V,l as P,i as f,k as S,v as y,C as J,S as g}from"./index.D6qiF35X.js";import{c as de,a as ue}from"./imageCompression.A--1eZQ5.js";import{u as ce,_ as pe,S as ve,f as me,g as ge,m as fe,h as xe,i as _e,j as ye,k as be}from"./SectionMain.LQE99ZwY.js";import{_ as he}from"./BaseButton.CMgDjKct.js";import{_ as we}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./BaseIcon.B-kGt5NE.js";const ke={key:0,class:"rounded-2xl border bg-white p-6 text-sm text-gray-500"},Ue={class:"relative overflow-hidden rounded-2xl border bg-white shadow-sm"},Ce={class:"relative h-48 sm:h-80 md:h-[360px] w-full bg-gray-100 group overflow-hidden rounded-t-2xl"},je=["src"],Pe={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-r from-indigo-50 to-blue-50 text-indigo-500"},Se=["disabled"],Be=["disabled"],Fe={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ae=["d"],Ne={class:"relative px-4 sm:px-6 pb-4 sm:pb-6"},Ve={class:"-mt-10 sm:-mt-12 flex flex-col sm:flex-row items-start sm:items-end gap-4"},De={class:"relative h-24 w-24 sm:h-28 sm:w-28 rounded-full border-4 border-white bg-gray-100 overflow-hidden shadow"},Ie=["src"],Le={key:1,class:"flex h-full w-full items-center justify-center bg-gray-200 text-gray-600 font-semibold"},Ee=["title","disabled"],$e={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ze=["d"],Me={class:"mt-2 sm:mt-11"},Te={class:"text-xl font-semibold text-gray-900"},Oe={class:"text-sm text-gray-500"},Re={key:0,class:"mt-2 max-w-2xl text-sm text-gray-700 whitespace-pre-line"},Ge={class:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6"},Ke={class:"lg:col-span-2 space-y-6"},qe={class:"rounded-2xl border bg-white shadow-sm"},He={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},Je={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Qe={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},We=["d"],Xe={class:"px-4 sm:px-6 py-4"},Ye={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ze=["readonly"],es=["readonly"],ss=["readonly"],ts={class:"sm:col-span-2"},as=["readonly"],ls={key:0,class:"mt-4 flex justify-end"},os=["disabled"],rs={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ns=["d"],is={class:"rounded-2xl border bg-white shadow-sm"},ds={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},us={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},cs={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ps=["d"],vs={class:"text-xs text-gray-500"},ms={class:"p-4 sm:p-6"},gs={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},fs={key:1,class:"text-sm text-gray-500"},xs={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},_s={class:"flex items-center gap-3"},ys={class:"h-10 w-10 rounded-lg bg-gray-100 overflow-hidden flex items-center justify-center text-xs font-semibold text-gray-600 shrink-0"},bs={class:"min-w-0"},hs={class:"truncate text-sm font-medium text-gray-900"},ws={class:"truncate text-xs text-gray-500"},ks={class:"mt-3 flex items-center justify-between"},Us={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},Cs={class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},js={class:"mt-2 text-[11px] text-gray-500 inline-flex items-center gap-1"},Ps={style:{width:"14px",height:"14px"},viewBox:"0 0 24 24"},Ss=["d"],Bs={class:"space-y-6"},Fs={key:0,class:"rounded-2xl border bg-white shadow-sm"},As={class:"border-b px-4 sm:px-6 py-3"},Ns={class:"text-sm font-semibold text-gray-800 inline-flex items-center gap-2"},Vs={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},Ds=["d"],Is={class:"px-4 sm:px-6 py-4"},Ls={class:"mt-4 flex justify-end"},Es={class:"rounded-2xl border bg-white shadow-sm"},$s={class:"p-4 sm:p-6 text-sm text-gray-700 space-y-2"},zs={class:"flex items-center justify-between"},Ms={class:"text-gray-500"},Ts={class:"flex items-center justify-between"},Os={class:"text-gray-500"},Rs={class:"flex items-center justify-between"},Gs={class:"text-gray-500"},Ks={__name:"ProfilePage",setup(qs){const Q=le(),d=ce(),W=oe(),b=m(()=>{const t=W.params.id;return typeof t=="string"&&t.trim()?Number(t):null}),D=m(()=>Q.user||{}),B=m(()=>D.value?.id||null),c=m(()=>b.value||B.value),r=m(()=>!!B.value&&B.value===c.value),F=p(!1),I=async()=>{if(c.value){F.value=!0;try{await d.fetchById(c.value),z(),await ae()}finally{F.value=!1}}};re(I),K(()=>b.value,async()=>{await I()});const v=m(()=>{if(b.value){const t=d.selectedUser;return t&&t.id===b.value?t:null}return d.selectedUser||D.value||{}}),L=m(()=>v.value?.avatar||""),E=m(()=>v.value?.cover||""),$=m(()=>v.value?.bio||""),i=p({username:"",first_name:"",last_name:"",bio:""}),z=()=>{const t=b.value?d.selectedUser&&d.selectedUser.id===b.value?d.selectedUser:{}:v.value||{};Object.assign(i.value,{username:t.username||"",first_name:t.first_name||"",last_name:t.last_name||"",bio:t.bio||""})};K(v,z);const M=p(null),T=p(null),k=p(!1),U=p(!1),C=p(!1),h=p(!1),j=p(!1),u=p({old_password:"",new_password:"",confirm_password:""}),w=p([]),O=m(()=>{const t=i.value.first_name?.trim()||"",s=i.value.last_name?.trim()||"";return t||s?`${t} ${s}`.trim():v.value?.email||""}),R=t=>(t||"").split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase(),X=t=>{if(!t)return"—";const s=new Date(t);return isNaN(s)?"—":s.toLocaleDateString()},Y=()=>{r.value&&M.value?.click()},Z=async t=>{const s=t.target.files?.[0];if(!(!s||!r.value||!c.value)){C.value=!0;try{const x=await ue(s);await d.uploadAvatar(c.value,x),g.fire("Updated","Profile photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload avatar","error")}finally{C.value=!1,t.target.value=""}}},ee=async t=>{const s=t.target.files?.[0];if(!(!s||!r.value||!c.value)){h.value=!0;try{const x=await de(s);await d.uploadCover(c.value,x),g.fire("Updated","Cover photo updated!","success")}catch{g.fire("Upload failed",d.error||"Could not upload cover","error")}finally{h.value=!1,t.target.value=""}}},se=async()=>{if(!(!r.value||!c.value)){k.value=!0;try{await d.updateById(c.value,{username:i.value.username||null,first_name:i.value.first_name||null,last_name:i.value.last_name||null,bio:i.value.bio||null}),g.fire("Saved","Profile updated successfully","success")}catch{g.fire("Update failed",d.error||"Could not update profile","error")}finally{k.value=!1}}},te=async()=>{if(r.value){if(!u.value.old_password||!u.value.new_password){g.fire("Missing fields","Please fill out both current and new password.","warning");return}if(u.value.new_password!==u.value.confirm_password){g.fire("Mismatch","New password and confirmation do not match.","warning");return}U.value=!0;try{await d.changePassword({old_password:u.value.old_password,new_password:u.value.new_password}),g.fire("Success","Password changed successfully","success"),Object.assign(u.value,{old_password:"",new_password:"",confirm_password:""})}catch{g.fire("Failed",d.error||"Could not change password","error")}finally{U.value=!1}}},ae=async()=>{if(c.value){j.value=!0;try{const t=await d.fetchUserDepartments(c.value,!0);w.value=Array.isArray(t)?t:[]}catch(t){console.error(t),w.value=[]}finally{j.value=!1}}};return(t,s)=>{const x=ne("router-link"),G=ie("pending-click");return l(),q(pe,null,{default:A(()=>[H(ve,null,{default:A(()=>[F.value||!v.value?(l(),o("div",ke," Loading profile… ")):(l(),o(N,{key:1},[e("div",Ue,[e("div",Ce,[E.value?(l(),o("img",{key:0,src:E.value,alt:"Cover",class:"h-full w-full object-cover",loading:"lazy"},null,8,je)):(l(),o("div",Pe,[...s[8]||(s[8]=[e("span",{class:"text-sm"},"No cover photo",-1)])])),e("input",{ref_key:"coverInput",ref:T,type:"file",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",disabled:h.value||!r.value,onChange:ee},null,40,Se),e("button",{type:"button",class:"absolute right-3 bottom-3 inline-flex items-center gap-2 rounded-xl bg-white/90 px-3 py-1.5 text-xs shadow hover:bg-white z-10 disabled:opacity-60",disabled:h.value||!r.value,onClick:s[0]||(s[0]=a=>T.value?.click())},[(l(),o("svg",Fe,[e("path",{d:_(me)},null,8,Ae)])),e("span",null,n(h.value?"Uploading…":r.value?"Change cover":"Cover"),1)],8,Be),s[9]||(s[9]=e("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1))]),e("div",Ne,[e("div",Ve,[e("div",De,[L.value?(l(),o("img",{key:0,src:L.value,alt:"Avatar",class:"h-full w-full object-cover",loading:"lazy"},null,8,Ie)):(l(),o("div",Le,n(R(O.value)),1)),e("button",{type:"button",class:"absolute right-0 bottom-0 m-1 rounded-full bg-white p-1 shadow hover:bg-gray-50 disabled:opacity-60",title:C.value?"Uploading…":r.value?"Change photo":"View only",disabled:C.value||!r.value,onClick:Y},[(l(),o("svg",$e,[e("path",{d:_(ge)},null,8,ze)]))],8,Ee),e("input",{ref_key:"avatarInput",ref:M,type:"file",accept:"image/*",class:"hidden",onChange:Z},null,544)]),e("div",Me,[e("div",Te,n(O.value),1),e("div",Oe,"@"+n(i.value.username||"username"),1),$.value?(l(),o("div",Re,n($.value),1)):V("",!0)])])])]),e("div",Ge,[e("div",Ke,[e("div",qe,[e("div",He,[e("h3",Je,[(l(),o("svg",Qe,[e("path",{d:_(fe)},null,8,We)])),P(" "+n(r.value?"Edit Profile":"Profile"),1)])]),e("div",Xe,[e("div",Ye,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Username",-1)),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>i.value.username=a),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"yourhandle"},null,10,Ze),[[y,i.value.username]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"First name",-1)),f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>i.value.first_name=a),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"First name"},null,10,es),[[y,i.value.first_name]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Last name",-1)),f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>i.value.last_name=a),readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Last name"},null,10,ss),[[y,i.value.last_name]])]),e("div",ts,[s[13]||(s[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Bio",-1)),f(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=a=>i.value.bio=a),rows:"4",readonly:!r.value,class:S(["w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-50",r.value?"":"bg-gray-50 text-gray-700"]),placeholder:"Tell us about yourself…"},null,10,as),[[y,i.value.bio]])])]),r.value?(l(),o("div",ls,[f((l(),o("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-xs font-medium text-white hover:bg-blue-700 disabled:opacity-50",disabled:k.value},[(l(),o("svg",rs,[e("path",{d:_(xe)},null,8,ns)])),e("span",null,n(k.value?"Saving…":"Save changes"),1)],8,os)),[[G,se]])])):V("",!0)])]),e("div",is,[e("div",ds,[e("h3",us,[(l(),o("svg",cs,[e("path",{d:_(_e)},null,8,ps)])),s[14]||(s[14]=P(" Departments ",-1))]),e("div",vs,n(j.value?"Loading…":`${w.value.length} affiliation(s)`),1)]),e("div",ms,[j.value?(l(),o("div",gs,[(l(),o(N,null,J(6,a=>e("div",{key:a,class:"animate-pulse rounded-xl border p-4"},[...s[15]||(s[15]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 rounded-lg bg-gray-200"}),e("div",{class:"flex-1"},[e("div",{class:"h-3 w-2/3 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-1/3 bg-gray-100 rounded"})])],-1),e("div",{class:"mt-4 h-6 w-24 bg-gray-100 rounded"},null,-1)])])),64))])):w.value.length?(l(),o("div",xs,[(l(!0),o(N,null,J(w.value,a=>(l(),q(x,{key:a.id,to:{name:"department-view",params:{id:a.id}},class:"group rounded-xl border p-4 bg-white block hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-300"},{default:A(()=>[e("div",_s,[e("div",ys,[e("span",null,n(R(a.name||a.code)),1)]),e("div",bs,[e("div",hs,n(a.name),1),e("div",ws,"@"+n(a.code),1)])]),e("div",ks,[e("span",Us,n(a.membership?.role||"member"),1),e("span",Cs,n(a.is_active?"active":"inactive"),1)]),e("div",js,[(l(),o("svg",Ps,[e("path",{d:_(ye)},null,8,Ss)])),P(" since "+n(X(a.membership?.joined_at)),1)])]),_:2},1032,["to"]))),128))])):(l(),o("div",fs," No departments yet. "))])])]),e("div",Bs,[r.value?(l(),o("div",Fs,[e("div",As,[e("h3",Ns,[(l(),o("svg",Vs,[e("path",{d:_(be)},null,8,Ds)])),s[16]||(s[16]=P(" Security ",-1))])]),e("div",Is,[s[17]||(s[17]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Current password",-1)),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>u.value.old_password=a),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"••••••••"},null,512),[[y,u.value.old_password]]),s[18]||(s[18]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"New password",-1)),f(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>u.value.new_password=a),type:"password",class:"mb-3 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"New password"},null,512),[[y,u.value.new_password]]),s[19]||(s[19]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Confirm new password",-1)),f(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>u.value.confirm_password=a),type:"password",class:"w-full rounded-lg border px-3 py-2 text-sm",placeholder:"Confirm password"},null,512),[[y,u.value.confirm_password]]),e("div",Ls,[f(H(he,{label:U.value?"Updating…":"Update password",color:"success",small:"",disabled:U.value},null,8,["label","disabled"]),[[G,te]])])])])):V("",!0),e("div",Es,[s[23]||(s[23]=e("div",{class:"border-b px-4 sm:px-6 py-3"},[e("h3",{class:"text-sm font-semibold text-gray-800"},"Account")],-1)),e("div",$s,[e("div",zs,[s[20]||(s[20]=e("span",null,"Email",-1)),e("span",Ms,n(v.value.email),1)]),e("div",Ts,[s[21]||(s[21]=e("span",null,"Role",-1)),e("span",Os,n(v.value.role||"user"),1)]),e("div",Rs,[s[22]||(s[22]=e("span",null,"2FA",-1)),e("span",Gs,n(v.value.twoFAEnabled?"Enabled":"Disabled"),1)])])])])])],64))]),_:1})]),_:1})}}},Zs=we(Ks,[["__scopeId","data-v-b3b43231"]]);export{Zs as default};
