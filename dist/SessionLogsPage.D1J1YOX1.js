const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.30pC7lFG.js","./index.BHdCrqYr.css"])))=>i.map(i=>d[i]);
import{Q as T,J as B,r as _,c as D,o as E,C as k,b as U,m as c,g as y,f as l,e as R,h as b,l as I,i as f,H as S,v,a as q,F as A,D as O,t as w,E as M,_ as N}from"./index.30pC7lFG.js";import{_ as z,S as K,z as j,p as F}from"./SectionMain.DiX6vrZb.js";import{_ as H}from"./SectionTitleLineWithButton.CETzqaqX.js";import{_ as L}from"./BaseButton.BFR-w0gE.js";import{B as Q}from"./BaseTable.BGzRVeJI.js";import{_ as W}from"./NotificationBar.DOzZq4hl.js";import{_ as J}from"./Badge.Cij2iGr6.js";import"./BaseIcon.DDP9Q-sB.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";function G(u={}){const{page:a,limit:s,sort:m,order:r,q:x,request_id:h,user_id:P,user_role:g,method:n,status:o,ip:e,created_from:t,created_to:d,...$}=u,i={page:a,limit:s,sort:m,order:typeof r=="string"?String(r).toUpperCase():r,q:x,request_id:h,user_id:P,user_role:g,method:n,status:o,ip:e,created_from:t,created_to:d,...$};return typeof i.method=="string"&&(i.method=i.method.toUpperCase()),typeof i.order=="string"&&(i.order=i.order.toUpperCase()),Object.keys(i).forEach(p=>i[p]===void 0&&delete i[p]),i}const V={async list(u={}){const a=G(u),{data:s}=await T.get("/session-logs",{params:a});return s},async getById(u){const{data:a}=await T.get(`/session-logs/${u}`);return a}},Z=B("sessionLog",()=>{const u=_({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),a=_(!1),s=_(null),m=_(!1),r=_(null);return{items:u,selected:r,isLoading:a,isLoaded:m,error:s,fetchAll:async(g={},n=!1)=>{if(s.value=null,!(!n&&m.value))try{a.value=!0;const o=await V.list(g);Object.assign(u.value,{total:o.total||0,totalPages:o.totalPages||1,currentPage:g.page||1,pageSize:g.limit||10,data:o.data||[]}),m.value=!0}catch(o){s.value=o?.response?.data?.message||o?.response?.message||o?.message||"Failed to fetch session logs"}finally{a.value=!1}},fetchById:async g=>{s.value=null;try{a.value=!0;const n=await V.getById(g);return r.value=n,n}catch(n){throw s.value=n?.response?.data?.message||n?.response?.message||n?.message||"Failed to fetch session log",n}finally{a.value=!1}},resetStore:()=>{u.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},r.value=null,m.value=!1,a.value=!1,s.value=null}}}),X={class:"grid grid-cols-1 md:grid-cols-6 gap-2 mb-3 text-sm"},Y=["value"],ee={class:"flex items-center justify-between mb-2"},te={class:"text-sm text-gray-500"},se={class:"flex gap-2"},ae=["title"],oe={class:"flex justify-end"},ce={__name:"SessionLogsPage",setup(u){const a=Z(),s=_({page:1,limit:10,q:"",method:"",status:"",user_id:"",user_role:"",ip:"",created_from:"",created_to:"",sort:"created_at",order:"DESC"}),m=D(()=>({total:a.items.total||0,totalPages:a.items.totalPages||1,currentPage:a.items.currentPage||1,pageSize:a.items.pageSize||10,data:a.items.data||[]})),r=async(o={},e=!0)=>{s.value={...s.value,...o};const t={...s.value};["q","method","status","user_id","user_role","ip","created_from","created_to","sort","order"].forEach(d=>{(t[d]===""||t[d]==null)&&delete t[d]}),await a.fetchAll(t,e)};E(async()=>{await r({page:1,limit:10})});const x=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],h=o=>{const e=Number(o||0);return e>=500?"red":e>=400?"amber":e>=300?"blue":"emerald"},P=[{key:"created_at",label:"Created",sortable:!0,width:170},{key:"request_id",label:"Request ID",sortable:!1,minWidth:140},{key:"method",label:"Method",sortable:!0,width:90},{key:"route",label:"Route",sortable:!1,minWidth:220},{key:"status",label:"Status",sortable:!0,width:100},{key:"response_time_ms",label:"Time (ms)",sortable:!0,width:110},{key:"user_id",label:"User",sortable:!0,width:90},{key:"user_role",label:"Role",sortable:!0,width:110},{key:"ip",label:"IP",sortable:!1,width:130}],g=async o=>{await a.fetchById(o.id);const e=a.selected||o,t=[["Created",e.created_at?new Date(e.created_at).toLocaleString():"-"],["Request ID",e.request_id||"-"],["User",e.user_id||"-"],["Role",e.user_role||"-"],["Method",e.method||"-"],["Route",e.route||"-"],["Status",e.status||"-"],["Response Time (ms)",e.response_time_ms??"-"],["IP",e.ip||"-"],["Origin",e.origin||"-"],["Referer",e.referer||"-"],["User Agent",e.user_agent||"-"]],d=p=>typeof p=="string"?p:JSON.stringify(p,null,2),$=`
    <div class="text-left text-sm">
      ${t.map(([p,C])=>`<div><strong>${p}:</strong> ${d(C)}</div>`).join("")}
      <div class="mt-2"><strong>Query:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${d(e.query||"{}")}</pre></div>
      <div class="mt-2"><strong>Body:</strong><pre class="mt-1 p-2 bg-gray-50 rounded overflow-auto">${d(e.body||"{}")}</pre></div>
    </div>`;await(await N(async()=>{const{default:p}=await import("./index.30pC7lFG.js").then(C=>C.Z);return{default:p}},__vite__mapDeps([0,1]),import.meta.url)).default.fire({title:"Session Log",html:$,width:800,confirmButtonText:"Close"})},n=(o,e=80)=>{if(o==null)return"";const t=String(o);return t.length>e?t.slice(0,e-1)+"…":t};return(o,e)=>(U(),k(z,null,{default:c(()=>[y(K,null,{default:c(()=>[y(H,{icon:b(j),title:"Session Logs",main:""},{default:c(()=>[...e[17]||(e[17]=[I(" Inspect API requests and responses ",-1)])]),_:1},8,["icon"]),l("div",X,[f(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.q=t),class:"border rounded px-2 py-1.5",placeholder:"Search…",onKeyup:e[1]||(e[1]=S(t=>r({page:1}),["enter"]))},null,544),[[v,s.value.q]]),f(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.method=t),class:"border rounded px-2 py-1.5",onChange:e[3]||(e[3]=t=>r({page:1}))},[e[18]||(e[18]=l("option",{value:""},"Any method",-1)),(U(),q(A,null,O(x,t=>l("option",{key:t,value:t},w(t),9,Y)),64))],544),[[M,s.value.method]]),f(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.status=t),class:"border rounded px-2 py-1.5",placeholder:"Status (e.g., 200)",onKeyup:e[5]||(e[5]=S(t=>r({page:1}),["enter"]))},null,544),[[v,s.value.status]]),f(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.user_id=t),class:"border rounded px-2 py-1.5",placeholder:"User ID",onKeyup:e[7]||(e[7]=S(t=>r({page:1}),["enter"]))},null,544),[[v,s.value.user_id]]),f(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.user_role=t),class:"border rounded px-2 py-1.5",placeholder:"User Role",onKeyup:e[9]||(e[9]=S(t=>r({page:1}),["enter"]))},null,544),[[v,s.value.user_role]]),f(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.ip=t),class:"border rounded px-2 py-1.5",placeholder:"IP",onKeyup:e[11]||(e[11]=S(t=>r({page:1}),["enter"]))},null,544),[[v,s.value.ip]]),f(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>s.value.created_from=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[13]||(e[13]=t=>r({page:1}))},null,544),[[v,s.value.created_from]]),f(l("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>s.value.created_to=t),type:"date",class:"border rounded px-2 py-1.5",onChange:e[15]||(e[15]=t=>r({page:1}))},null,544),[[v,s.value.created_to]])]),l("div",ee,[l("div",te,[e[19]||(e[19]=I("Total: ",-1)),l("b",null,w(m.value.total),1)]),l("div",se,[y(L,{icon:b(F),color:"info",label:"Refresh",onClick:e[16]||(e[16]=t=>r({},!0))},null,8,["icon"])])]),b(a).error?(U(),k(W,{key:0,color:"danger"},{default:c(()=>[I(w(b(a).error),1)]),_:1})):R("",!0),y(Q,{columns:P,data:m.value,loading:b(a).isLoading,onQueryChange:r},{"cell-created_at":c(({row:t})=>[l("span",null,w(t.created_at?new Date(t.created_at).toLocaleString():"-"),1)]),"cell-route":c(({row:t})=>[l("span",{title:t.route},w(n(t.route,80)),9,ae)]),"cell-status":c(({row:t})=>[y(J,{text:t.status,tone:h(t.status)},null,8,["text","tone"])]),"cell-actions":c(({row:t})=>[l("div",oe,[y(L,{small:"",color:"primary",label:"View",onClick:d=>g(t)},null,8,["onClick"])])]),_:1},8,["data","loading"])]),_:1})]),_:1}))}};export{ce as default};
