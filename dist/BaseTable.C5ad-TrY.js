import{r as h,z as R,B as z,b as n,m as Q,e as i,g as ie,H as we,Q as re,R as xe,c as P,N as O,o as _e,y as Ce,a as o,U as B,h as c,f as V,F as g,C as E,j as I,t as M,l as w,v as Se,T as $e,w as q,O as Ae,V as Be}from"./index.DJOQ5Iyl.js";import{_ as $}from"./BaseButton.C0hFA93F.js";import{A as Ve,B as ne,C as Me,g as J,D as Pe,w as ze,E as Ee}from"./SectionMain.BsQNe68V.js";import{_ as Le}from"./_plugin-vue_export-helper.DlAUqK2U.js";const Ne={class:"checkbox"},oe={__name:"TableCheckboxCell",props:{type:{type:String,default:"td"},modelValue:Boolean},emits:["update:modelValue"],setup(u,{emit:b}){const p=u,m=b,x=h(p.modelValue);return R(x,r=>{m("update:modelValue",r)}),R(()=>p.modelValue,r=>{x.value=r}),(r,d)=>(n(),z(re(u.type),{class:"lg:w-1"},{default:Q(()=>[i("label",Ne,[ie(i("input",{"onUpdate:modelValue":d[0]||(d[0]=v=>x.value=v),type:"checkbox"},null,512),[[we,x.value]]),d[1]||(d[1]=i("span",{class:"check"},null,-1))])]),_:1}))}},je=Object.assign({name:"BaseButtons"},{__name:"BaseButtons",props:{noWrap:{type:Boolean,default:!1},type:{type:String,default:"justify-start"},classAddon:{type:String,default:"mr-3 last:mr-0 mb-3"},mb:{type:String,default:"-mb-3"}},setup(u){const b=u,p=xe(),m=P(()=>{const x=!!p.default,r=["flex","items-center",b.type,b.noWrap?"flex-nowrap":"flex-wrap"];b.mb&&r.push(b.mb);const d=x?p.default().map(v=>v&&v.children&&typeof v.children=="object"?O(v,{},v.children.map(_=>O(_,{class:[b.classAddon]}))):O(v,{class:[b.classAddon]})):null;return O("div",{class:r},d)});return(x,r)=>(n(),z(re(m.value)))}}),Te={class:"relative space-y-2"},De={class:"flex items-center justify-between"},Ue={class:"w-full border-collapse bg-white min-w-full"},Fe={class:"bg-white text-gray-700 text-sm border-b"},Oe={key:0,class:"p-2 w-10 text-center"},Ie={class:"flex items-center justify-between"},Re={class:"font-medium"},We={class:"flex items-center gap-2"},He={key:0,class:"mt-1 p-2 border rounded bg-white shadow-md"},qe=["onUpdate:modelValue","onInput"],Je={key:1,class:"px-2 py-1 text-right w-1 whitespace-nowrap"},Qe={key:0},Ke=["colspan"],Ge={key:0,class:"p-2 w-10 text-center","data-label":"Select"},Xe=["data-label"],Ye={class:"py-1 text-sm"},Ze=["disabled","onClick"],et={key:0,class:"w-4 h-4",viewBox:"0 0 24 24"},tt=["d"],lt={class:"truncate"},at={key:0},st={key:1},nt={key:1,class:"px-4 py-2 whitespace-nowrap","data-label":"Action"},ot={key:1,class:"border-t text-sm font-semibold bg-gray-50"},it={key:0,class:"p-2 w-10"},rt=["data-label"],ut={key:0},dt={key:1,class:"px-4 py-2"},ct={class:"p-3 border rounded-lg bg-white text-sm flex flex-col sm:flex-row sm:justify-between sm:items-center"},vt={class:"mb-2 sm:mb-0"},ft={class:"flex flex-wrap items-center gap-2"},pt=["value"],yt={__name:"BaseTable",props:{columns:{type:Array,default:()=>[]},data:{type:Object,default:()=>({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]})},checkable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showAction:{type:Boolean,default:!0}},emits:["query-change","selected","sort","filter","edit"],setup(u,{emit:b}){const p=u,m=b,x=h(null),r=h(p.data.currentPage||1),d=h(p.data.pageSize||10),v=h(null),_=h("desc"),C=h({}),T=h({}),A=h(new Set),L=h(null),K=h({top:"0px",left:"0px",minWidth:"176px"});R(()=>p.data.currentPage,t=>r.value=t||1),R(()=>p.data.pageSize,t=>d.value=t||10);const k=P(()=>p.data||{total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),W=P(()=>k.value.data.filter(t=>Object.keys(C.value).every(a=>C.value[a]?t[a]?.toString().toLowerCase().includes(C.value[a].toLowerCase()):!0))),ue=P(()=>A.value.size===W.value.length&&W.value.length>0),D=P(()=>k.value.totalPages||Math.ceil(k.value.total/d.value)||1),de=P(()=>{const t=D.value,a=r.value,e=2,l=[];if(t<=7)for(let s=1;s<=t;s++)l.push(s);else{l.push(1);let s=Math.max(2,a-e),y=Math.min(t-1,a+e);s>2&&l.push("...");for(let f=s;f<=y;f++)l.push(f);y<t-1&&l.push("..."),l.push(t)}return l}),N=()=>{m("query-change",{page:r.value,limit:d.value,sort:v.value,order:_.value,filters:C.value})},U=t=>{t>=1&&t<=D.value&&(r.value=t,N())},ce=t=>{d.value=Number(t.target.value),r.value=1,N()},G=t=>{v.value===t?_.value=_.value==="asc"?"desc":"asc":(v.value=t,_.value="desc"),m("sort",{key:v.value,order:_.value}),N()},X=t=>{T.value[t]=!T.value[t]},Y=(t,a)=>{C.value[t]=a,m("filter",C.value),N()},ve=t=>{t?A.value=new Set(W.value.map(a=>a.id)):A.value.clear(),m("selected",Array.from(A.value))},fe=(t,a)=>{t?A.value.add(a.id):A.value.delete(a.id),m("selected",Array.from(A.value))},Z=t=>m("edit",t),ee=(t,a)=>`${t.id??t._key??JSON.stringify(t)}:${a?.key??"actions"}`,pe=(t,a)=>L.value===ee(t,a),ye=(t,a,e)=>{const l=ee(t,a);if(L.value===l){L.value=null;return}try{const s=e?.currentTarget||e?.target;if(s&&typeof s.getBoundingClientRect=="function"){const y=s.getBoundingClientRect(),f=176,se=6,he=window.innerWidth||document.documentElement.clientWidth,be=window.innerHeight||document.documentElement.clientHeight;let ke=Math.min(he-f-8,Math.max(8,y.right-f)),H=y.bottom+se;H+240>be&&y.top>240&&(H=Math.max(8,y.top-se-240)),K.value={position:"fixed",top:`${H}px`,left:`${ke}px`,minWidth:`${f}px`}}}catch{}L.value=l},te=()=>{L.value=null},j=(t,a)=>typeof t?.visible=="function"?!!t.visible(a):typeof t?.visible=="boolean"?t.visible:!0,F=(t,a)=>typeof t?.disabled=="function"?!!t.disabled(a):typeof t?.disabled=="boolean"?t.disabled:!1,me=t=>{const a=String(t?.tone||"").toLowerCase();return a==="danger"?"text-red-600 hover:bg-red-50":a==="warning"?"text-amber-700 hover:bg-amber-50":a==="success"?"text-emerald-700 hover:bg-emerald-50":""},le=async(t,a)=>{t&&(t.confirm&&!window.confirm(typeof t.confirm=="string"?t.confirm:"Are you sure?")||(typeof t.onClick=="function"?t.onClick(a):typeof t.emit=="string"&&m(t.emit,a),te()))};let S=null;_e(()=>{typeof window<"u"&&(S=()=>{te()},window.addEventListener("click",S),window.addEventListener("resize",S),window.addEventListener("scroll",S,!0))}),Ce(()=>{S&&typeof window<"u"&&(window.removeEventListener("click",S),window.removeEventListener("resize",S),window.removeEventListener("scroll",S,!0),S=null)});const ae=P(()=>{const t={};return p.columns.forEach(a=>{if(a.aggregate){let e=0;k.value.data.forEach(l=>{const s=parseFloat(l[a.key]);isNaN(s)||(e+=s)}),t[a.key]=e}}),t}),ge=P(()=>p.columns.some(t=>t.aggregate));return(t,a)=>(n(),o("div",Te,[i("div",De,[i("div",null,[B(t.$slots,"toolbar-left",{},void 0,!0)]),i("div",null,[B(t.$slots,"toolbar-right",{},void 0,!0)])]),i("div",{ref_key:"tableContainer",ref:x,class:"table-container relative rounded-lg border border-gray-200 shadow-sm bg-white"},[i("table",Ue,[i("thead",Fe,[i("tr",null,[u.checkable?(n(),o("th",Oe,[V(oe,{modelValue:ue.value,"onUpdate:modelValue":ve},null,8,["modelValue"])])):c("",!0),(n(!0),o(g,null,E(u.columns,e=>(n(),o("th",{key:e.key,class:I(["px-4 py-2 text-left",e.key==="actions"||e.isAction?"whitespace-nowrap":"whitespace-normal break-words"])},[B(t.$slots,`header-${e.key}`,{column:e,sort:{key:v.value,order:_.value,toggle:()=>G(e.key)},filter:{value:C.value[e.key]||"",set:l=>Y(e.key,l),open:!!T.value[e.key],toggle:()=>X(e.key)}},()=>[i("div",Ie,[i("span",Re,M(e.label),1),i("div",We,[e.sortable?(n(),z($,{key:0,icon:v.value===e.key?_.value==="asc"?w(Ve):w(ne):w(ne),small:"",onClick:l=>G(e.key)},null,8,["icon","onClick"])):c("",!0),e.filterable?(n(),z($,{key:1,icon:w(Me),small:"",onClick:l=>X(e.key)},null,8,["icon","onClick"])):c("",!0)])]),V($e,{name:"fade"},{default:Q(()=>[T.value[e.key]?(n(),o("div",He,[ie(i("input",{"onUpdate:modelValue":l=>C.value[e.key]=l,class:"w-full px-2 py-1 text-xs border rounded",placeholder:"Filter...",onInput:l=>Y(e.key,l.target.value)},null,40,qe),[[Se,C.value[e.key]]])])):c("",!0)]),_:2},1024)],!0)],2))),128)),u.showAction?(n(),o("th",Je)):c("",!0)])]),i("tbody",null,[!k.value.data.length&&!u.loading?(n(),o("tr",Qe,[i("td",{colspan:u.columns.length+(u.checkable?1:0)+(u.showAction?1:0),class:"p-6"},[B(t.$slots,"empty",{},()=>[a[4]||(a[4]=i("div",{class:"text-center text-sm text-gray-500"},"No data to display.",-1))],!0)],8,Ke)])):c("",!0),(n(!0),o(g,null,E(k.value.data,e=>(n(),o("tr",{key:e.id??e._key??JSON.stringify(e),class:"border-t text-sm hover:bg-gray-50"},[u.checkable?(n(),o("td",Ge,[V(oe,{modelValue:A.value.has(e.id),"onUpdate:modelValue":l=>fe(l,e)},null,8,["modelValue","onUpdate:modelValue"])])):c("",!0),(n(!0),o(g,null,E(u.columns,l=>(n(),o("td",{key:l.key,class:I(["px-4 py-2 align-top",l.key==="actions"||l.isAction?"whitespace-nowrap":"whitespace-normal break-words"]),"data-label":l.label},[B(t.$slots,`cell-${l.key}`,{row:e,value:e[l.key],column:l},()=>[l.key==="actions"||l.isAction?(n(),o("div",{key:0,class:"relative flex items-center justify-end gap-1 select-none",onClick:a[1]||(a[1]=q(()=>{},["stop"]))},[Array.isArray(l.actions)&&l.actions.length?(n(),o(g,{key:0},[l.actions.filter(s=>j(s,e)).length?(n(),o(g,{key:0},[(n(!0),o(g,null,E(l.actions.filter(s=>j(s,e)),(s,y)=>(n(),o(g,{key:"p-"+y},[s.primary&&y===l.actions.findIndex(f=>j(f,e)&&f.primary)||!l.actions.some(f=>j(f,e)&&f.primary)&&y===0?(n(),z($,{key:0,class:"hidden sm:inline-flex",icon:s.icon||w(J),label:s.showLabel?s.label:"",small:"",title:s.tooltip||s.label,disabled:F(s,e),onClick:f=>le(s,e)},null,8,["icon","label","title","disabled","onClick"])):c("",!0)],64))),128)),V($,{icon:w(Pe),small:"",title:"More actions",onClick:q(s=>ye(e,l,s),["stop"])},null,8,["icon","onClick"]),(n(),z(Be,{to:"body"},[pe(e,l)?(n(),o("div",{key:0,style:Ae(K.value),class:"fixed z-[9999] w-44 rounded-md border bg-white shadow-lg",onClick:a[0]||(a[0]=q(()=>{},["stop"]))},[i("ul",Ye,[(n(!0),o(g,null,E(l.actions.filter(s=>j(s,e)),(s,y)=>(n(),o("li",{key:"m-"+y},[i("button",{class:I(["w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center gap-2",[me(s),F(s,e)?"opacity-50 cursor-not-allowed":""]]),disabled:F(s,e),onClick:f=>!F(s,e)&&le(s,e)},[s.icon?(n(),o("svg",et,[i("path",{d:s.icon},null,8,tt)])):c("",!0),i("span",lt,M(s.label),1)],10,Ze)]))),128))])],4)):c("",!0)]))],64)):c("",!0)],64)):(n(),z($,{key:1,icon:w(J),small:"",title:"Edit",onClick:s=>Z(e)},null,8,["icon","onClick"]))])):(n(),o(g,{key:1},[l.formatter?(n(),o("span",at,M(l.formatter(e[l.key],e)),1)):(n(),o("span",st,M(e[l.key]??"-"),1))],64))],!0)],10,Xe))),128)),u.showAction?(n(),o("td",nt,[B(t.$slots,"cell-actions",{row:e},()=>[V(je,null,{default:Q(()=>[V($,{icon:w(J),small:"",onClick:l=>Z(e)},null,8,["icon","onClick"])]),_:2},1024)],!0)])):c("",!0)]))),128)),ge.value?(n(),o("tr",ot,[u.checkable?(n(),o("td",it)):c("",!0),(n(!0),o(g,null,E(u.columns,e=>(n(),o("td",{key:e.key,class:I(["px-4 py-2",e.key==="actions"||e.isAction?"whitespace-nowrap":"whitespace-normal break-words"]),"data-label":e.label},[B(t.$slots,`aggregate-${e.key}`,{value:ae.value[e.key],column:e},()=>[e.aggregate?(n(),o("span",ut,M(ae.value[e.key]),1)):c("",!0)],!0)],10,rt))),128)),u.showAction?(n(),o("td",dt)):c("",!0)])):c("",!0)])])],512),B(t.$slots,"pagination",{page:r.value,pageSize:d.value,total:k.value.total,totalPages:D.value,goToPage:U,setPageSize:e=>{d.value=e,r.value=1,N()}},()=>[i("div",ct,[i("span",vt,M(k.value.total?(r.value-1)*d.value+1:0)+" - "+M(Math.min(r.value*d.value,k.value.total))+" of "+M(k.value.total)+" items ",1),i("div",ft,[V($,{icon:w(ze),small:"",disabled:r.value===1,onClick:a[2]||(a[2]=e=>U(r.value-1))},null,8,["icon","disabled"]),(n(!0),o(g,null,E(de.value,(e,l)=>(n(),z($,{key:l,active:e!=="..."&&e===r.value,label:e,small:"",disabled:e==="...",onClick:s=>e!=="..."&&U(e)},null,8,["active","label","disabled","onClick"]))),128)),V($,{icon:w(Ee),small:"",disabled:r.value===D.value,onClick:a[3]||(a[3]=e=>U(r.value+1))},null,8,["icon","disabled"]),i("select",{class:"border p-1 text-sm rounded",onChange:ce,value:d.value},[...a[5]||(a[5]=[i("option",{value:"5"},"5 / page",-1),i("option",{value:"10"},"10 / page",-1),i("option",{value:"20"},"20 / page",-1)])],40,pt)])])],!0)]))}},kt=Le(yt,[["__scopeId","data-v-8f7164fd"]]);export{kt as B};
