import{r as y,z as F,C as z,b as n,m as G,f as i,i as de,I as _e,R as ce,U as Se,c as M,O as W,y as $e,A as ie,o as Ae,a as o,V as $,e as d,g as B,F as h,D as L,k as H,t as P,h as C,v as Ve,T as Be,w as K,P as Pe,W as Me}from"./index.30pC7lFG.js";import{_ as A}from"./BaseButton.BFR-w0gE.js";import{A as ze,B as re,C as Ee,g as Q,D as Le,w as De,E as Ne}from"./SectionMain.DiX6vrZb.js";import{_ as Te}from"./_plugin-vue_export-helper.DlAUqK2U.js";const je={class:"checkbox"},ue={__name:"TableCheckboxCell",props:{type:{type:String,default:"td"},modelValue:Boolean},emits:["update:modelValue"],setup(u,{emit:b}){const f=u,g=b,k=y(f.modelValue);return F(k,w=>{g("update:modelValue",w)}),F(()=>f.modelValue,w=>{k.value=w}),(w,c)=>(n(),z(ce(u.type),{class:"lg:w-1"},{default:G(()=>[i("label",je,[de(i("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>k.value=r),type:"checkbox"},null,512),[[_e,k.value]]),c[1]||(c[1]=i("span",{class:"check"},null,-1))])]),_:1}))}},Fe=Object.assign({name:"BaseButtons"},{__name:"BaseButtons",props:{noWrap:{type:Boolean,default:!1},type:{type:String,default:"justify-start"},classAddon:{type:String,default:"mr-3 last:mr-0 mb-3"},mb:{type:String,default:"-mb-3"}},setup(u){const b=u,f=Se(),g=M(()=>{const k=!!f.default,w=["flex","items-center",b.type,b.noWrap?"flex-nowrap":"flex-wrap"];b.mb&&w.push(b.mb);const c=k?f.default().map(r=>r&&r.children&&typeof r.children=="object"?W(r,{},r.children.map(m=>W(m,{class:[b.classAddon]}))):W(r,{class:[b.classAddon]})):null;return W("div",{class:w},c)});return(k,w)=>(n(),z(ce(g.value)))}}),Ie={class:"relative space-y-2"},Ue={class:"flex items-center justify-between"},Oe={class:"w-full border-collapse bg-white min-w-full"},Re={class:"bg-white text-gray-700 text-sm border-b"},We={key:0,class:"p-2 w-10 text-center"},He={class:"flex items-center justify-between"},qe={class:"font-medium"},Je={class:"flex items-center gap-2"},Ke={key:0,class:"mt-1 p-2 border rounded bg-white shadow-md"},Qe=["onUpdate:modelValue","onInput"],Ge={key:1,class:"px-2 py-1 text-right w-1 whitespace-nowrap"},Xe={key:0},Ye=["colspan"],Ze={key:0,class:"p-2 w-10 text-center","data-label":"Select"},et=["data-label"],tt={class:"py-1 text-sm"},lt=["disabled","onClick"],at={key:0,class:"w-4 h-4",viewBox:"0 0 24 24"},st=["d"],nt={class:"truncate"},ot={key:0},it={key:1},rt={key:1,class:"px-4 py-2 whitespace-nowrap","data-label":"Action"},ut={key:1,class:"border-t text-sm font-semibold bg-gray-50"},dt={key:0,class:"p-2 w-10"},ct=["data-label"],vt={key:0},ft={key:1,class:"px-4 py-2"},pt={class:"p-3 border rounded-lg bg-white text-sm flex flex-col sm:flex-row sm:justify-between sm:items-center"},yt={class:"mb-2 sm:mb-0"},gt={class:"flex flex-wrap items-center gap-2"},mt=["value"],ht={__name:"BaseTable",props:{columns:{type:Array,default:()=>[]},data:{type:Object,default:()=>({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]})},checkable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showAction:{type:Boolean,default:!0}},emits:["query-change","selected","sort","filter","edit"],setup(u,{emit:b}){const f=u,g=b,k=y(null),w=$e.useLoading(),c=y(null);F(()=>f.loading,t=>{t?c.value||(c.value=w.show({container:k.value,canCancel:!1,isFullPage:!1,color:"#3b82f6",opacity:.8})):c.value&&(c.value.hide(),c.value=null)},{immediate:!0}),ie(()=>{c.value&&(c.value.hide(),c.value=null)});const r=y(f.data.currentPage||1),m=y(f.data.pageSize||10),D=y(null),E=y("desc"),_=y({}),I=y({}),V=y(new Set),N=y(null),X=y({top:"0px",left:"0px",minWidth:"176px"});F(()=>f.data.currentPage,t=>r.value=t||1),F(()=>f.data.pageSize,t=>m.value=t||10);const x=M(()=>f.data||{total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),q=M(()=>x.value.data.filter(t=>Object.keys(_.value).every(a=>_.value[a]?t[a]?.toString().toLowerCase().includes(_.value[a].toLowerCase()):!0))),ve=M(()=>V.value.size===q.value.length&&q.value.length>0),U=M(()=>x.value.totalPages||Math.ceil(x.value.total/m.value)||1),fe=M(()=>{const t=U.value,a=r.value,e=2,l=[];if(t<=7)for(let s=1;s<=t;s++)l.push(s);else{l.push(1);let s=Math.max(2,a-e),p=Math.min(t-1,a+e);s>2&&l.push("...");for(let v=s;v<=p;v++)l.push(v);p<t-1&&l.push("..."),l.push(t)}return l}),T=()=>{g("query-change",{page:r.value,limit:m.value,sort:D.value,order:E.value,filters:_.value})},O=t=>{t>=1&&t<=U.value&&(r.value=t,T())},pe=t=>{m.value=Number(t.target.value),r.value=1,T()},Y=t=>{D.value===t?E.value=E.value==="asc"?"desc":"asc":(D.value=t,E.value="desc"),g("sort",{key:D.value,order:E.value}),T()},Z=t=>{I.value[t]=!I.value[t]},ee=(t,a)=>{_.value[t]=a,g("filter",_.value),T()},ye=t=>{t?V.value=new Set(q.value.map(a=>a.id)):V.value.clear(),g("selected",Array.from(V.value))},ge=(t,a)=>{t?V.value.add(a.id):V.value.delete(a.id),g("selected",Array.from(V.value))},te=t=>g("edit",t),le=(t,a)=>`${t.id??t._key??JSON.stringify(t)}:${a?.key??"actions"}`,me=(t,a)=>N.value===le(t,a),he=(t,a,e)=>{const l=le(t,a);if(N.value===l){N.value=null;return}try{const s=e?.currentTarget||e?.target;if(s&&typeof s.getBoundingClientRect=="function"){const p=s.getBoundingClientRect(),v=176,oe=6,we=window.innerWidth||document.documentElement.clientWidth,xe=window.innerHeight||document.documentElement.clientHeight;let Ce=Math.min(we-v-8,Math.max(8,p.right-v)),J=p.bottom+oe;J+240>xe&&p.top>240&&(J=Math.max(8,p.top-oe-240)),X.value={position:"fixed",top:`${J}px`,left:`${Ce}px`,minWidth:`${v}px`}}}catch{}N.value=l},ae=()=>{N.value=null},j=(t,a)=>typeof t?.visible=="function"?!!t.visible(a):typeof t?.visible=="boolean"?t.visible:!0,R=(t,a)=>typeof t?.disabled=="function"?!!t.disabled(a):typeof t?.disabled=="boolean"?t.disabled:!1,be=t=>{const a=String(t?.tone||"").toLowerCase();return a==="danger"?"text-red-600 hover:bg-red-50":a==="warning"?"text-amber-700 hover:bg-amber-50":a==="success"?"text-emerald-700 hover:bg-emerald-50":""},se=async(t,a)=>{t&&(t.confirm&&!window.confirm(typeof t.confirm=="string"?t.confirm:"Are you sure?")||(typeof t.onClick=="function"?t.onClick(a):typeof t.emit=="string"&&g(t.emit,a),ae()))};let S=null;Ae(()=>{typeof window<"u"&&(S=()=>{ae()},window.addEventListener("click",S),window.addEventListener("resize",S),window.addEventListener("scroll",S,!0))}),ie(()=>{S&&typeof window<"u"&&(window.removeEventListener("click",S),window.removeEventListener("resize",S),window.removeEventListener("scroll",S,!0),S=null)});const ne=M(()=>{const t={};return f.columns.forEach(a=>{if(a.aggregate){let e=0;x.value.data.forEach(l=>{const s=parseFloat(l[a.key]);isNaN(s)||(e+=s)}),t[a.key]=e}}),t}),ke=M(()=>f.columns.some(t=>t.aggregate));return(t,a)=>(n(),o("div",Ie,[i("div",Ue,[i("div",null,[$(t.$slots,"toolbar-left",{},void 0,!0)]),i("div",null,[$(t.$slots,"toolbar-right",{},void 0,!0)])]),i("div",{ref_key:"tableContainer",ref:k,class:"table-container relative rounded-lg border border-gray-200 shadow-sm bg-white"},[i("table",Oe,[i("thead",Re,[i("tr",null,[u.checkable?(n(),o("th",We,[B(ue,{modelValue:ve.value,"onUpdate:modelValue":ye},null,8,["modelValue"])])):d("",!0),(n(!0),o(h,null,L(u.columns,e=>(n(),o("th",{key:e.key,class:H(["px-4 py-2 text-left",e.key==="actions"||e.isAction?"whitespace-nowrap":"whitespace-normal break-words"])},[$(t.$slots,`header-${e.key}`,{column:e,sort:{key:D.value,order:E.value,toggle:()=>Y(e.key)},filter:{value:_.value[e.key]||"",set:l=>ee(e.key,l),open:!!I.value[e.key],toggle:()=>Z(e.key)}},()=>[i("div",He,[i("span",qe,P(e.label),1),i("div",Je,[e.sortable?(n(),z(A,{key:0,icon:D.value===e.key?E.value==="asc"?C(ze):C(re):C(re),small:"",onClick:l=>Y(e.key)},null,8,["icon","onClick"])):d("",!0),e.filterable?(n(),z(A,{key:1,icon:C(Ee),small:"",onClick:l=>Z(e.key)},null,8,["icon","onClick"])):d("",!0)])]),B(Be,{name:"fade"},{default:G(()=>[I.value[e.key]?(n(),o("div",Ke,[de(i("input",{"onUpdate:modelValue":l=>_.value[e.key]=l,class:"w-full px-2 py-1 text-xs border rounded",placeholder:"Filter...",onInput:l=>ee(e.key,l.target.value)},null,40,Qe),[[Ve,_.value[e.key]]])])):d("",!0)]),_:2},1024)],!0)],2))),128)),u.showAction?(n(),o("th",Ge)):d("",!0)])]),i("tbody",null,[!x.value.data.length&&!u.loading?(n(),o("tr",Xe,[i("td",{colspan:u.columns.length+(u.checkable?1:0)+(u.showAction?1:0),class:"p-6"},[$(t.$slots,"empty",{},()=>[a[4]||(a[4]=i("div",{class:"text-center text-sm text-gray-500"},"No data to display.",-1))],!0)],8,Ye)])):d("",!0),(n(!0),o(h,null,L(x.value.data,e=>(n(),o("tr",{key:e.id??e._key??JSON.stringify(e),class:"border-t text-sm hover:bg-gray-50"},[u.checkable?(n(),o("td",Ze,[B(ue,{modelValue:V.value.has(e.id),"onUpdate:modelValue":l=>ge(l,e)},null,8,["modelValue","onUpdate:modelValue"])])):d("",!0),(n(!0),o(h,null,L(u.columns,l=>(n(),o("td",{key:l.key,class:H(["px-4 py-2 align-top",l.key==="actions"||l.isAction?"whitespace-nowrap":"whitespace-normal break-words"]),"data-label":l.label},[$(t.$slots,`cell-${l.key}`,{row:e,value:e[l.key],column:l},()=>[l.key==="actions"||l.isAction?(n(),o("div",{key:0,class:"relative flex items-center justify-end gap-1 select-none",onClick:a[1]||(a[1]=K(()=>{},["stop"]))},[Array.isArray(l.actions)&&l.actions.length?(n(),o(h,{key:0},[l.actions.filter(s=>j(s,e)).length?(n(),o(h,{key:0},[(n(!0),o(h,null,L(l.actions.filter(s=>j(s,e)),(s,p)=>(n(),o(h,{key:"p-"+p},[s.primary&&p===l.actions.findIndex(v=>j(v,e)&&v.primary)||!l.actions.some(v=>j(v,e)&&v.primary)&&p===0?(n(),z(A,{key:0,class:"hidden sm:inline-flex",icon:s.icon||C(Q),label:s.showLabel?s.label:"",small:"",title:s.tooltip||s.label,disabled:R(s,e),onClick:v=>se(s,e)},null,8,["icon","label","title","disabled","onClick"])):d("",!0)],64))),128)),B(A,{icon:C(Le),small:"",title:"More actions",onClick:K(s=>he(e,l,s),["stop"])},null,8,["icon","onClick"]),(n(),z(Me,{to:"body"},[me(e,l)?(n(),o("div",{key:0,style:Pe(X.value),class:"fixed z-[9999] w-44 rounded-md border bg-white shadow-lg",onClick:a[0]||(a[0]=K(()=>{},["stop"]))},[i("ul",tt,[(n(!0),o(h,null,L(l.actions.filter(s=>j(s,e)),(s,p)=>(n(),o("li",{key:"m-"+p},[i("button",{class:H(["w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center gap-2",[be(s),R(s,e)?"opacity-50 cursor-not-allowed":""]]),disabled:R(s,e),onClick:v=>!R(s,e)&&se(s,e)},[s.icon?(n(),o("svg",at,[i("path",{d:s.icon},null,8,st)])):d("",!0),i("span",nt,P(s.label),1)],10,lt)]))),128))])],4)):d("",!0)]))],64)):d("",!0)],64)):(n(),z(A,{key:1,icon:C(Q),small:"",title:"Edit",onClick:s=>te(e)},null,8,["icon","onClick"]))])):(n(),o(h,{key:1},[l.formatter?(n(),o("span",ot,P(l.formatter(e[l.key],e)),1)):(n(),o("span",it,P(e[l.key]??"-"),1))],64))],!0)],10,et))),128)),u.showAction?(n(),o("td",rt,[$(t.$slots,"cell-actions",{row:e},()=>[B(Fe,null,{default:G(()=>[B(A,{icon:C(Q),small:"",onClick:l=>te(e)},null,8,["icon","onClick"])]),_:2},1024)],!0)])):d("",!0)]))),128)),ke.value?(n(),o("tr",ut,[u.checkable?(n(),o("td",dt)):d("",!0),(n(!0),o(h,null,L(u.columns,e=>(n(),o("td",{key:e.key,class:H(["px-4 py-2",e.key==="actions"||e.isAction?"whitespace-nowrap":"whitespace-normal break-words"]),"data-label":e.label},[$(t.$slots,`aggregate-${e.key}`,{value:ne.value[e.key],column:e},()=>[e.aggregate?(n(),o("span",vt,P(ne.value[e.key]),1)):d("",!0)],!0)],10,ct))),128)),u.showAction?(n(),o("td",ft)):d("",!0)])):d("",!0)])]),u.loading?$(t.$slots,"loading-overlay",{key:0},void 0,!0):d("",!0)],512),$(t.$slots,"pagination",{page:r.value,pageSize:m.value,total:x.value.total,totalPages:U.value,goToPage:O,setPageSize:e=>{m.value=e,r.value=1,T()}},()=>[i("div",pt,[i("span",yt,P(x.value.total?(r.value-1)*m.value+1:0)+" - "+P(Math.min(r.value*m.value,x.value.total))+" of "+P(x.value.total)+" items ",1),i("div",gt,[B(A,{icon:C(De),small:"",disabled:r.value===1,onClick:a[2]||(a[2]=e=>O(r.value-1))},null,8,["icon","disabled"]),(n(!0),o(h,null,L(fe.value,(e,l)=>(n(),z(A,{key:l,active:e!=="..."&&e===r.value,label:e,small:"",disabled:e==="...",onClick:s=>e!=="..."&&O(e)},null,8,["active","label","disabled","onClick"]))),128)),B(A,{icon:C(Ne),small:"",disabled:r.value===U.value,onClick:a[3]||(a[3]=e=>O(r.value+1))},null,8,["icon","disabled"]),i("select",{class:"border p-1 text-sm rounded",onChange:pe,value:m.value},[...a[5]||(a[5]=[i("option",{value:"5"},"5 / page",-1),i("option",{value:"10"},"10 / page",-1),i("option",{value:"20"},"20 / page",-1)])],40,mt)])])],!0)]))}},Ct=Te(ht,[["__scopeId","data-v-55e2369a"]]);export{Ct as B};
