import{c as J,s as K,r as l,o as W,z as X,C as M,b as i,m as v,q as Z,p as ee,g as d,f as e,e as D,h as T,l as E,t as o,a as n,F as b,D as h,k as te,T as se,i as j,v as $,E as ae,I as le,S as N}from"./index.30pC7lFG.js";import{_ as ie,S as oe,v as ne,w as re,p as de}from"./SectionMain.DiX6vrZb.js";import{_ as ce}from"./SectionTitleLineWithButton.CETzqaqX.js";import{_ as ue}from"./NotificationBar.DOzZq4hl.js";import{_ as m}from"./BaseButton.BFR-w0gE.js";import{_ as me}from"./Badge.Cij2iGr6.js";import{u as pe}from"./department.xfrS98De.js";import{u as ve}from"./evaluation.CZtRfh7N.js";import"./BaseIcon.DDP9Q-sB.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const _e={class:"mb-3 flex items-center justify-between"},xe={class:"flex items-center gap-2"},ge={class:"flex items-center gap-2"},fe={class:"rounded-2xl border bg-white shadow-sm mb-4"},ye={class:"px-4 sm:px-6 py-4 grid grid-cols-1 md:grid-cols-4 gap-3 items-center"},be={class:"flex items-center gap-3 md:col-span-2"},he={class:"h-12 w-12 rounded-lg bg-gray-100 grid place-items-center text-gray-700 text-sm font-semibold"},we={class:"min-w-0"},ke={class:"truncate text-lg font-semibold text-gray-900"},Se={class:"truncate text-xs text-gray-500"},Ce={class:"md:col-span-2 flex items-center gap-2 justify-start md:justify-end"},De={key:0,class:"px-4 sm:px-6 pb-4 text-sm text-gray-700"},je={class:"rounded-2xl border bg-white shadow-sm"},Ae={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},Be={class:"text-xs text-gray-500"},Me={class:"p-4 sm:p-6"},Te={key:0,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},Ee={key:1,class:"text-sm text-gray-500"},Le={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},Ve={class:"flex items-center gap-3"},$e={class:"h-10 w-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center"},Ne=["src"],Ie={key:1,class:"text-xs font-semibold text-gray-600"},Re={class:"min-w-0"},Ue={class:"truncate text-sm font-medium text-gray-900"},Fe={class:"truncate text-xs text-gray-500"},Ge={class:"mt-3 flex items-center justify-between"},ze={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},Oe={class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},Pe={class:"mt-2 text-[11px] text-gray-500 inline-flex items-center gap-1"},qe={class:"rounded-2xl border bg-white shadow-sm mt-4"},Ye={class:"border-b px-4 sm:px-6 py-3 flex items-center justify-between"},Qe={class:"flex items-center gap-2"},He={class:"text-xs text-gray-500"},Je={class:"p-4 sm:p-6"},Ke={key:0,class:"text-sm text-gray-500"},We={key:1,class:"text-sm text-gray-500"},Xe={key:2},Ze={class:"overflow-x-auto border rounded"},et={class:"w-full text-sm"},tt={class:"p-2"},st={class:"p-2"},at={class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},lt={class:"p-2"},it={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},ot={class:"p-2"},nt={class:"p-2 text-right"},rt={key:0,class:"fixed inset-0 bg-black/30 z-50 grid place-items-center"},dt={class:"bg-white rounded-2xl shadow-xl w-full max-w-2xl"},ct={class:"px-4 sm:px-6 py-3 border-b flex items-center justify-between"},ut={class:"text-lg font-semibold"},mt={class:"p-4 sm:p-6 space-y-3"},pt={key:0,class:"text-xs text-red-600"},vt={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},_t={id:"areas-dept"},xt=["value"],gt=["value"],ft={class:"flex items-center gap-2 mt-6"},yt={class:"pt-2 flex justify-end"},Tt={__name:"DepartmentView",setup(bt){const p=pe(),I=K(),R=Z();ve();const c=J(()=>Number(I.params.id)),L=l(!1),w=l(""),u=l(null),_=l([]),k=l(!1),x=l([]),S=l(!1),A=async()=>{if(w.value="",!!c.value)try{L.value=!0,u.value=await p.fetchById(c.value)}catch(a){w.value=a?.response?.data?.message||a?.message||"Failed to load department"}finally{L.value=!1}},B=async()=>{if(c.value)try{k.value=!0;const a=await p.fetchMembers(c.value,!0);_.value=Array.isArray(a)?a:[]}catch{_.value=[]}finally{k.value=!1}},C=async()=>{if(c.value)try{S.value=!0;const a=await p.fetchStandards(c.value,{},!0);x.value=Array.isArray(a)?a:[]}catch{x.value=[]}finally{S.value=!1}};W(async()=>{await A(),await B(),await C()}),X(()=>c.value,async()=>{await A(),await B(),await C()});const V=a=>String(a||"").split(/\s+/).filter(Boolean).map(s=>s[0]).join("").slice(0,2).toUpperCase(),U=()=>R.back(),F=["Governance","Records","Processes","Quality","Resources"],G=["core","core function","extra"],g=l(!1),f=l("create"),r=l({id:null,description:"",area:"Governance",type:"core",is_active:!0}),y=l({}),z=()=>{f.value="create",r.value={id:null,description:"",area:"Governance",type:"core",is_active:!0},y.value={},g.value=!0},O=a=>{f.value="edit",r.value={id:a.id,description:a.description||"",area:a.area||"Governance",type:a.type||"core",is_active:!!a.is_active},y.value={},g.value=!0},P=()=>{const a={};return r.value.description?.trim()||(a.description="Description is required"),y.value=a,Object.keys(a).length===0},q=async()=>{if(!P())return;const a={description:r.value.description.trim(),area:(r.value.area||"").trim(),type:(r.value.type||"").trim()||null,is_active:!!r.value.is_active};f.value==="create"?await p.createStandard(c.value,a):await p.updateStandard(r.value.id,a,{departmentId:c.value}),g.value=!1,await C()},Y=async a=>{!a?.id||!(await N.fire({title:"Delete standard?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete"})).isConfirmed||(await p.deleteStandard(a.id,{departmentId:c.value}),await C(),await N.fire("Deleted","Standard removed.","success"))};return l(!1),l("create"),l({id:null,standard_id:"",academic_year:"",semester:"",status:"in_progress",priority:"medium",deadline:"",assigned_to_id:""}),l([]),l({}),l(""),l([]),l(!1),l([]),(a,s)=>{const Q=ee("router-link");return i(),M(ie,null,{default:v(()=>[d(oe,null,{default:v(()=>[d(ce,{icon:T(ne),title:"Department",main:""},{default:v(()=>[...s[6]||(s[6]=[E(" Details and active members ",-1)])]),_:1},8,["icon"]),e("div",_e,[e("div",xe,[d(m,{icon:T(re),color:"secondary",outline:"",small:"",label:"Back",onClick:U},null,8,["icon"])]),e("div",ge,[d(m,{icon:T(de),color:"info",label:"Refresh",onClick:s[0]||(s[0]=()=>{A(),B()})},null,8,["icon"])])]),w.value?(i(),M(ue,{key:0,color:"danger"},{default:v(()=>[E(o(w.value),1)]),_:1})):D("",!0),e("div",fe,[e("div",ye,[e("div",be,[e("div",he,o(V(u.value?.name||u.value?.code)),1),e("div",we,[e("div",ke,o(u.value?.name||"-"),1),e("div",Se,"@"+o(u.value?.code||"-"),1)])]),e("div",Ce,[d(me,{text:u.value?.is_active?"Active":"Inactive",tone:u.value?.is_active?"emerald":"gray"},null,8,["text","tone"])])]),u.value?.description?(i(),n("div",De,o(u.value.description),1)):D("",!0)]),e("div",je,[e("div",Ae,[s[7]||(s[7]=e("h3",{class:"text-sm font-semibold text-gray-800"},"Members",-1)),e("div",Be,o(k.value?"Loading...":`${_.value.length} member(s)`),1)]),e("div",Me,[k.value?(i(),n("div",Te,[(i(),n(b,null,h(6,t=>e("div",{key:t,class:"animate-pulse rounded-xl border p-4"},[...s[8]||(s[8]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"h-10 w-10 rounded-full bg-gray-200"}),e("div",{class:"flex-1"},[e("div",{class:"h-3 w-2/3 bg-gray-200 rounded mb-2"}),e("div",{class:"h-3 w-1/3 bg-gray-100 rounded"})])],-1)])])),64))])):_.value.length?(i(),n("div",Le,[(i(!0),n(b,null,h(_.value,t=>(i(),M(Q,{key:t.id,to:{name:"profile",params:{id:t.id}},class:"group rounded-xl border p-4 bg-white block hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-300"},{default:v(()=>[e("div",Ve,[e("div",$e,[t.avatar?(i(),n("img",{key:0,src:t.avatar,alt:"avatar",class:"h-full w-full object-cover"},null,8,Ne)):(i(),n("span",Ie,o(V(t.username)),1))]),e("div",Re,[e("div",Ue,"@"+o(t.username),1),e("div",Fe,o((t.first_name||"")+" "+(t.last_name||"")),1)])]),e("div",Ge,[e("span",ze,o(t.membership?.role||"member"),1),e("span",Oe,o(u.value?.name||"Department"),1)]),e("div",Pe,[e("span",null,"since "+o(t.membership?.joined_at?new Date(t.membership.joined_at).toLocaleDateString():"-"),1)])]),_:2},1032,["to"]))),128))])):(i(),n("div",Ee,"No members yet."))])]),e("div",qe,[e("div",Ye,[s[9]||(s[9]=e("h3",{class:"text-sm font-semibold text-gray-800"},"Standards",-1)),e("div",Qe,[e("div",He,o(S.value?"Loading...":`${x.value.length} item(s)`),1),d(m,{color:"primary",label:"Add Standard",onClick:z})])]),e("div",Je,[S.value?(i(),n("div",Ke,"Loading...")):x.value.length?(i(),n("div",Xe,[e("div",Ze,[e("table",et,[s[10]||(s[10]=e("thead",null,[e("tr",{class:"bg-gray-50 text-gray-600"},[e("th",{class:"text-left p-2"},"Description"),e("th",{class:"text-left p-2"},"Area"),e("th",{class:"text-left p-2"},"Type"),e("th",{class:"text-left p-2"},"Active"),e("th",{class:"text-right p-2"},"Actions")])],-1)),e("tbody",null,[(i(!0),n(b,null,h(x.value,t=>(i(),n("tr",{key:t.id,class:"border-t"},[e("td",tt,o(t.description),1),e("td",st,[e("span",at,o(t.area||"-"),1)]),e("td",lt,[e("span",it,o(t.type||"-"),1)]),e("td",ot,[e("span",{class:te(["inline-flex items-center rounded-full",t.is_active?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-gray-50 text-gray-700 ring-gray-200"]),style:{padding:"1px 6px","font-size":"11px"}},o(t.is_active?"Yes":"No"),3)]),e("td",nt,[d(m,{small:"",color:"secondary",outline:"",label:"Edit",class:"mr-2",onClick:H=>O(t)},null,8,["onClick"]),d(m,{small:"",color:"danger",outline:"",label:"Delete",onClick:H=>Y(t)},null,8,["onClick"])])]))),128))])])])])):(i(),n("div",We,"No standards yet."))])]),d(se,{name:"fade"},{default:v(()=>[g.value?(i(),n("div",rt,[e("div",dt,[e("div",ct,[e("h3",ut,o(f.value==="create"?"Create Standard":"Edit Standard"),1),d(m,{label:"Close",color:"secondary",outline:"",small:"",onClick:s[1]||(s[1]=t=>g.value=!1)})]),e("div",mt,[e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm mb-1"},[E("Description "),e("span",{class:"text-red-500"},"*")],-1)),j(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=t=>r.value.description=t),rows:"3",class:"w-full border p-2 rounded",placeholder:"Describe the standard..."},null,512),[[$,r.value.description]]),y.value.description?(i(),n("div",pt,o(y.value.description),1)):D("",!0)]),e("div",vt,[e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm mb-1"},"Area",-1)),j(e("input",{list:"areas-dept","onUpdate:modelValue":s[3]||(s[3]=t=>r.value.area=t),class:"w-full border p-2 rounded",placeholder:"e.g., Governance"},null,512),[[$,r.value.area]]),e("datalist",_t,[(i(),n(b,null,h(F,t=>e("option",{key:t,value:t},null,8,xt)),64))])]),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm mb-1"},"Type",-1)),j(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>r.value.type=t),class:"w-full border p-2 rounded"},[(i(),n(b,null,h(G,t=>e("option",{key:t,value:t},o(t),9,gt)),64))],512),[[ae,r.value.type]])]),e("div",ft,[j(e("input",{id:"std_is_active",type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=t=>r.value.is_active=t),class:"h-4 w-4"},null,512),[[le,r.value.is_active]]),s[14]||(s[14]=e("label",{for:"std_is_active",class:"text-sm"},"Active",-1))])]),e("div",yt,[d(m,{color:"primary",label:f.value==="create"?"Create":"Save Changes",onClick:q},null,8,["label"])])])])])):D("",!0)]),_:1})]),_:1})]),_:1})}}};export{Tt as default};
