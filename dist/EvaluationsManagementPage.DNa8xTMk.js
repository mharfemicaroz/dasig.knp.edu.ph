import{u as Pe,c as U,r as d,z as O,o as Ne,A as Ie,B as ee,b as l,m as A,a as r,h as v,e as a,f as x,j as z,g as _,F as g,C as f,l as I,t as n,D as S,G as ze,w as te,v as ne,k as R,T as je,n as F,x as Ke,S as Te}from"./index.DJOQ5Iyl.js";import{_ as We,S as Qe,c as Ge,q as He,p as Je,g as Xe,s as Ze}from"./SectionMain.BsQNe68V.js";import{_ as et}from"./SectionTitleLineWithButton.x2H-uCcb.js";import{B as tt}from"./BaseTable.C5ad-TrY.js";import{_ as $}from"./BaseButton.C0hFA93F.js";import{_ as Ue}from"./NotificationBar.Cr7JbaUA.js";import{_ as Re}from"./Badge.D1llaE8V.js";import{u as Oe}from"./evaluation.CLlqW2My.js";import{u as qe,s as Be}from"./department.C9-risKs.js";import{_ as Ye}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./BaseIcon.uCs_PDtB.js";const at={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/35 backdrop-blur-[1px]"},st={class:"bg-white rounded-2xl shadow-2xl w-full max-w-7xl overflow-hidden"},lt={class:"px-4 sm:px-6 py-3 border-b flex items-center justify-between"},rt={class:"flex items-center gap-3"},it={class:"hidden md:flex items-center text-xs text-gray-500 gap-2"},nt={class:"p-4 sm:p-6 grid grid-cols-1 xl:grid-cols-4 gap-4 max-h-[78vh] overflow-y-auto"},ot={class:"xl:col-span-1 space-y-4"},dt=["value"],ut=["value"],ct={key:0,class:"text-xs text-red-600 mt-1"},vt={class:"grid grid-cols-2 gap-2"},mt=["value"],pt={key:0,class:"text-xs text-red-600 mt-1"},gt=["value"],ft=["onKeydown"],yt={key:0,class:"p-2 text-xs text-gray-500"},_t=["data-user-id","onClick","onKeydown"],xt={class:"truncate"},bt={key:0,class:"text-[11px] text-gray-500"},wt={key:0,class:"p-2 text-xs text-gray-500"},ht={key:0,class:"text-xs text-red-600 mt-1"},kt={class:"pt-2 flex justify-end"},St={class:"px-3 py-2 border-b flex items-center justify-between"},$t={class:"p-3"},Ct={key:0,class:"text-xs text-gray-500 mb-2"},Dt={class:"max-h-72 overflow-auto divide-y"},At=["onDragstart"],Lt={class:"text-sm text-gray-800"},Vt={class:"flex justify-end gap-2 mt-1"},Et={key:0,class:"p-2 text-xs text-gray-500"},Ut={key:0,class:"text-xs text-red-600"},Nt={class:"px-3 py-2 border-b flex items-center justify-between"},It={class:"font-medium text-sm"},Mt={class:"flex items-center gap-2 text-xs"},Tt={class:"flex items-center gap-1"},Rt={class:"flex items-center gap-1"},Pt={class:"p-3"},jt=["onDragstart"],Ot={class:"text-sm font-medium text-gray-800"},qt={class:"grid grid-cols-3 gap-2 mt-2 items-center"},Bt={class:"text-[11px] text-gray-600"},Yt=["onUpdate:modelValue"],Ft={class:"text-[11px] text-gray-600"},zt=["onUpdate:modelValue"],Kt={class:"text-[11px] text-gray-600"},Wt=["onUpdate:modelValue"],Qt={class:"flex justify-end mt-2"},Gt={key:0,class:"text-xs text-red-600 mt-2"},Ht={key:1,class:"text-xs text-gray-500 border border-dashed rounded p-3 text-center"},Jt={class:"pt-3 flex justify-end"},Xt={class:"rounded-xl border"},Zt={class:"p-3 space-y-2"},ea={key:0,class:"max-h-40 overflow-auto border rounded"},ta={key:0,class:"p-2 text-xs text-gray-500"},aa={class:"truncate"},sa={key:0,class:"p-2 text-xs text-gray-500"},la={class:"flex flex-wrap gap-2"},ra=["onClick"],ia={class:"px-4 sm:px-6 py-3 border-t flex items-center justify-between"},na={class:"flex items-center gap-2"},oa={__name:"EvaluationUI2Modal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","submitted"],setup(Me,{emit:w}){const B=Me,K=w,L=Oe(),C=qe(),ae=Pe(),oe=U(()=>String(ae.user?.role||"").toLowerCase()==="admin"),se=d([]),W=U(()=>(se.value||[]).filter(t=>String(t?.membership?.role||t?.UserDepartment?.role||t?.user_department?.role||"").toLowerCase()==="supervisor")),Y=U({get:()=>B.modelValue,set:t=>K("update:modelValue",t)}),ye=(()=>{const t=new Date().getFullYear();return Array.from({length:6},(e,s)=>`${t+s}-${t+s+1}`)})(),ce=["1st Semester","2nd Semester","Summer"],u=d({department_id:"",assigned_to_id:"",academic_year:"",semester:""}),h=d({}),D=d(1),c=d(null),V=d(null),P=d(null),ve=d(null),_e=d(null),xe=d(null),le=d([]),me=d(!1),re=d(""),Q=U(()=>{const t=re.value.trim().toLowerCase(),e=(le.value||[]).filter(s=>String(s?.membership?.role||"").toLowerCase()==="member");return t?e.filter(s=>String(s.username||"").toLowerCase().includes(t)||String(s.first_name||"").toLowerCase().includes(t)||String(s.last_name||"").toLowerCase().includes(t)):e}),y=d([]),p=d(!1),N=d(""),q=U(()=>{const t=N.value.trim().toLowerCase();return t?y.value.filter(e=>String(e.description||"").toLowerCase().includes(t)||String(e.id).includes(t)):y.value}),b=d([]),k=d("in_progress"),G=d("medium"),j=d(()=>{const t=new Date;t.setDate(t.getDate()+7);const e=s=>String(s).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`}),M=d(null),be=t=>{M.value=t},we=()=>{M.value&&(ge(M.value),M.value=null)},pe=async()=>{if(le.value=[],!!u.value.department_id){me.value=!0;try{const t=await C.fetchMembers(u.value.department_id,!0);le.value=Array.isArray(t)?t:[]}finally{me.value=!1}}},he=async()=>{if(y.value=[],!!u.value.department_id){p.value=!0;try{const t=await Be.list({department_id:u.value.department_id,limit:200});y.value=Array.isArray(t?.data)?t.data:[]}finally{p.value=!1}}},ge=t=>{!t||!t.id||b.value.find(e=>e.id===t.id)||(b.value.push({id:t.id,description:t.description,status:k.value,priority:G.value,deadline:typeof j.value=="function"?j.value():j.value}),y.value=(y.value||[]).filter(e=>e.id!==t.id),Se())},de=t=>{const e=b.value.find(s=>s.id===t);b.value=b.value.filter(s=>s.id!==t),e&&!(y.value||[]).some(s=>s.id===e.id)&&(y.value=[...y.value||[],{id:e.id,description:e.description}])},Ce=()=>{const t=(q.value||[]).slice();if(!t.length)return;const e=new Set((b.value||[]).map(m=>m.id)),s=[],o=new Set;for(const m of t)!m||!m.id||e.has(m.id)||(s.push({id:m.id,description:m.description,status:k.value,priority:G.value,deadline:typeof j.value=="function"?j.value():j.value}),o.add(m.id));s.length&&(b.value=[...b.value,...s]),o.size&&(y.value=(y.value||[]).filter(m=>!o.has(m.id))),Se()},ke=d(null),Se=()=>{try{F(()=>{const t=ke.value;t&&(t.scrollTop=t.scrollHeight)})}catch{}},$e=()=>{try{F(()=>{const t=P.value;if(!t||!u.value.assigned_to_id)return;const e=t.querySelector(`[data-user-id="${u.value.assigned_to_id}"]`);e&&typeof e.scrollIntoView=="function"&&e.scrollIntoView({block:"nearest"})})}catch{}},De=t=>{!t||!t.id||(u.value.assigned_to_id=t.id,$e())},ue=(t,e)=>{t.key==="Enter"&&(u.value.assigned_to_id=e.id,$e())},fe=()=>{const t={};return u.value.department_id||(t.department_id="Department is required"),u.value.assigned_to_id||(t.assigned_to_id="Assignee is required"),b.value.length||(t.standards="Select at least one standard"),u.value.academic_year?.trim()||(t.academic_year="Academic year is required"),T.value.length||(t.evaluators="At least one supervisor is required"),h.value=t,Object.keys(t).length===0},H=d(!1),Ae=async()=>{if(fe()){H.value=!0;try{const t={academic_year:u.value.academic_year.trim(),semester:u.value.semester||null,assigned_to_id:Number(u.value.assigned_to_id)},e=[];for(const s of b.value){const o={...t,standard_id:Number(s.id),status:s.status||"in_progress",priority:s.priority||"medium",deadline:s.deadline?new Date(s.deadline):null},m=await L.create(o);if(m?.id){if(T.value.length)try{await L.setEvaluators(m.id,T.value.map(Fe=>Fe.id))}catch{}e.push(m)}}K("submitted",e),Y.value=!1}finally{H.value=!1}}};O(()=>u.value.department_id,async(t,e)=>{t&&(await Promise.all([pe(),he()]),D.value=2,await F(),V.value?.focus())}),O(Y,async t=>{if(t){if(D.value=1,h.value={},b.value=[],re.value="",le.value=[],u.value.assigned_to_id="",N.value="",y.value=[],Z.value="",ie.value=[],T.value=[],(!Array.isArray(C.departments?.data)||!C.departments?.data?.length)&&await C.fetchAll({page:1,limit:100},!0),!oe.value&&ae.user?.id)try{se.value=await Ie.getDepartments(ae.user.id)}catch{se.value=[]}if(u.value={department_id:"",assigned_to_id:"",academic_year:"",semester:""},oe.value){const e=C.departments?.data?.[0];e?.id&&(u.value.department_id=Number(e.id))}else{const e=W.value?.[0];e?.id&&(u.value.department_id=Number(e.id))}u.value.academic_year||(u.value.academic_year=ye[0]||""),u.value.semester||(u.value.semester=ce[0]||"1st Semester"),await F(),c.value?.focus()}}),Ne(async()=>{if((!Array.isArray(C.departments?.data)||!C.departments?.data?.length)&&await C.fetchAll({page:1,limit:100},!0),ae.user?.id)try{se.value=await Ie.getDepartments(ae.user.id)}catch{se.value=[]}}),O(()=>B.modelValue,async t=>{if(t){if(oe.value){if(!u.value.department_id){const e=C.departments?.data?.[0];e?.id&&(u.value.department_id=Number(e.id))}}else if(!u.value.department_id){const e=W.value?.[0];e?.id&&(u.value.department_id=Number(e.id))}await F(),c.value?.focus()}}),O(()=>re.value,()=>{try{F(()=>{P.value&&(P.value.scrollTop=0)})}catch{}});const Le=async()=>{let t=!1;const e={...h.value};if(u.value.academic_year?.trim()||(e.academic_year="Academic year is required",t=!0),u.value.assigned_to_id||(e.assigned_to_id="Assignee is required",t=!0),h.value=e,t){await F(),u.value.academic_year?.trim()?V.value?.focus():xe.value?.focus();return}D.value=3,await F(),ve.value?.focus()},J=async()=>{if(!b.value.length){h.value={...h.value,standards:"Select at least one standard"};return}D.value=4,await F(),_e.value?.focus()},X=()=>{Y.value=!1},Z=d(""),E=d(!1),ie=d([]),T=d([]),Ve=async()=>{const t=(Z.value||"").trim().toLowerCase(),e=new Set((T.value||[]).map(m=>m.id)),s=(le.value||[]).filter(m=>String(m?.membership?.role||"").toLowerCase()==="supervisor"),o=t?s.filter(m=>String(m.username||"").toLowerCase().includes(t)||String(m.first_name||"").toLowerCase().includes(t)||String(m.last_name||"").toLowerCase().includes(t)):s;ie.value=o.filter(m=>!e.has(m.id)).slice(0,20)},Ee=t=>{!t||!t.id||(T.value.find(e=>e.id===t.id)||T.value.push(t),Z.value="",ie.value=[])},i=t=>{T.value=T.value.filter(e=>e.id!==t.id)};return O(()=>u.value.semester,t=>{try{t!=null&&localStorage.setItem("dasig:lastSemester",String(t))}catch{}}),(t,e)=>(l(),ee(je,{name:"fade"},{default:A(()=>[Y.value?(l(),r("div",at,[a("div",st,[a("div",lt,[a("div",rt,[e[11]||(e[11]=a("h3",{class:"text-lg font-semibold"},"Evaluation",-1)),a("div",it,[a("span",{class:z(["px-2 py-[2px] rounded-full",D.value>=1?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"bg-gray-100 text-gray-500"])},"1. Department",2),a("span",{class:z(["px-2 py-[2px] rounded-full",D.value>=2?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"bg-gray-100 text-gray-500"])},"2. Assignee",2),a("span",{class:z(["px-2 py-[2px] rounded-full",D.value>=3?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"bg-gray-100 text-gray-500"])},"3. Standards",2),a("span",{class:z(["px-2 py-[2px] rounded-full",D.value>=4?"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200":"bg-gray-100 text-gray-500"])},"4. Supervisors",2)])]),x($,{label:"Close",color:"secondary",outline:"",small:"",onClick:X})]),a("div",nt,[a("div",ot,[a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm mb-1"},"Department",-1)),_(a("select",{ref_key:"deptSelectRef",ref:c,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.department_id=s),class:"w-full border p-2 rounded"},[oe.value?(l(!0),r(g,{key:0},f(I(C).departments.data,s=>(l(),r("option",{key:"admin-"+s.id,value:s.id},n(s.name),9,dt))),128)):(l(!0),r(g,{key:1},f(W.value,s=>(l(),r("option",{key:"my-"+s.id,value:s.id},n(s.name),9,ut))),128))],512),[[S,u.value.department_id]]),h.value.department_id?(l(),r("div",ct,n(h.value.department_id),1)):v("",!0)]),a("div",{class:z([D.value>=2?"opacity-100":"opacity-50 pointer-events-none","space-y-2"])},[a("div",null,[a("div",vt,[a("div",null,[e[13]||(e[13]=a("label",{class:"block text-xs text-gray-600 mb-1"},"A.Y.",-1)),_(a("select",{ref_key:"aySelectRef",ref:xe,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.academic_year=s),class:"w-full border p-2 rounded"},[(l(!0),r(g,null,f(I(ye),s=>(l(),r("option",{value:s,key:s},n(s),9,mt))),128))],512),[[S,u.value.academic_year]]),h.value.academic_year?(l(),r("div",pt,n(h.value.academic_year),1)):v("",!0)]),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-xs text-gray-600 mb-1"},"Semester",-1)),_(a("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.semester=s),class:"w-full border p-2 rounded"},[e[14]||(e[14]=a("option",{value:""},"-",-1)),(l(),r(g,null,f(ce,s=>a("option",{key:s,value:s},n(s),9,gt)),64))],512),[[S,u.value.semester]])])])]),e[16]||(e[16]=a("label",{class:"block text-sm mb-1"},"Assignee",-1)),_(a("input",{ref_key:"assigneeInputRef",ref:V,"onUpdate:modelValue":e[3]||(e[3]=s=>re.value=s),placeholder:"Search username or name",class:"w-full border p-2 rounded",onKeydown:ze(te(()=>{},["prevent"]),["enter"])},null,40,ft),[[ne,re.value]]),a("div",{ref_key:"assigneeListRef",ref:P,class:"border rounded max-h-64 overflow-y-auto mt-2"},[me.value?(l(),r("div",yt,"Loading members…")):(l(),r(g,{key:1},[(l(!0),r(g,null,f(Q.value,s=>(l(),r("div",{key:s.id,"data-user-id":s.id,tabindex:"0",class:"px-2 py-1 text-sm flex items-center justify-between hover:bg-gray-50 focus:bg-gray-50 cursor-pointer",onClick:o=>De(s),onKeydown:o=>ue(o,s)},[a("div",xt,"@"+n(s.username)+" — "+n(s.first_name||"")+" "+n(s.last_name||""),1),u.value.assigned_to_id===s.id?(l(),r("span",bt,"Selected")):v("",!0)],40,_t))),128)),Q.value.length?v("",!0):(l(),r("div",wt,"No members"))],64))],512),h.value.assigned_to_id?(l(),r("div",ht,n(h.value.assigned_to_id),1)):v("",!0)],2),a("div",kt,[x($,{small:"",color:"primary",outline:"",disabled:!u.value.academic_year?.trim()||!u.value.assigned_to_id,label:"Next: Standards",onClick:Le},null,8,["disabled"])])]),a("div",{class:z(["xl:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-4",D.value>=3?"opacity-100":"opacity-50 pointer-events-none"])},[a("div",{class:"border rounded-lg",onDragover:e[5]||(e[5]=te(()=>{},["prevent"])),onDrop:e[6]||(e[6]=te(()=>{M.value?.value?.id&&de(M.value.value.id),M.value.value=null},["prevent"]))},[a("div",St,[e[17]||(e[17]=a("div",{class:"font-medium text-sm"},"Available Standards",-1)),x($,{small:"",color:"primary",outline:"",disabled:!q.value.length,label:`Add All (${q.value.length})`,onClick:Ce},null,8,["disabled","label"])]),a("div",$t,[_(a("input",{ref_key:"standardSearchRef",ref:ve,"onUpdate:modelValue":e[4]||(e[4]=s=>N.value=s),placeholder:"Search standards",class:"w-full border p-2 rounded mb-2"},null,512),[[ne,N.value]]),p.value?(l(),r("div",Ct,"Loading standards…")):v("",!0),a("div",Dt,[(l(!0),r(g,null,f(q.value,s=>(l(),r("div",{key:s.id,draggable:"true",onDragstart:()=>be(s),class:"py-2 px-2 hover:bg-gray-50 cursor-grab select-none"},[a("div",Lt,"#"+n(s.id)+" — "+n(s.description),1),a("div",Vt,[x($,{small:"",color:"primary",outline:"",label:"Add",onClick:o=>ge(s)},null,8,["onClick"])])],40,At))),128)),!q.value.length&&!p.value?(l(),r("div",Et,"No results")):v("",!0)])]),h.value.evaluators?(l(),r("div",Ut,n(h.value.evaluators),1)):v("",!0)],32),a("div",{class:"lg:col-span-2 border rounded-lg",onDragover:e[9]||(e[9]=te(()=>{},["prevent"])),onDrop:te(we,["prevent"])},[a("div",Nt,[a("div",It,"Selected Standards ("+n(b.value.length)+")",1),a("div",Mt,[a("label",Tt,[e[19]||(e[19]=a("span",null,"Default Status",-1)),_(a("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>k.value=s),class:"border rounded px-1 py-[2px] text-xs"},[...e[18]||(e[18]=[a("option",{value:"in_progress"},"in_progress",-1),a("option",{value:"complied"},"complied",-1),a("option",{value:"not_complied"},"not_complied",-1)])],512),[[S,k.value]])]),a("label",Rt,[e[21]||(e[21]=a("span",null,"Default Priority",-1)),_(a("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>G.value=s),class:"border rounded px-1 py-[2px] text-xs"},[...e[20]||(e[20]=[a("option",{value:"low"},"low",-1),a("option",{value:"medium"},"medium",-1),a("option",{value:"high"},"high",-1),a("option",{value:"urgent"},"urgent",-1)])],512),[[S,G.value]])])])]),a("div",Pt,[a("div",{ref_key:"selectedScrollRef",ref:ke,class:"max-h-80 overflow-y-auto pr-1 grid grid-cols-1 md:grid-cols-2 gap-3"},[(l(!0),r(g,null,f(b.value,s=>(l(),r("div",{key:s.id,class:"border rounded p-2",draggable:"true",onDragstart:()=>be({id:s.id,description:s.description})},[a("div",Ot,"#"+n(s.id)+" — "+n(s.description),1),a("div",qt,[a("label",Bt,[e[23]||(e[23]=R("Status ",-1)),_(a("select",{"onUpdate:modelValue":o=>s.status=o,class:"w-full border rounded p-1 text-xs"},[...e[22]||(e[22]=[a("option",{value:"in_progress"},"in_progress",-1),a("option",{value:"complied"},"complied",-1),a("option",{value:"not_complied"},"not_complied",-1)])],8,Yt),[[S,s.status]])]),a("label",Ft,[e[25]||(e[25]=R("Priority ",-1)),_(a("select",{"onUpdate:modelValue":o=>s.priority=o,class:"w-full border rounded p-1 text-xs"},[...e[24]||(e[24]=[a("option",{value:"low"},"low",-1),a("option",{value:"medium"},"medium",-1),a("option",{value:"high"},"high",-1),a("option",{value:"urgent"},"urgent",-1)])],8,zt),[[S,s.priority]])]),a("label",Kt,[e[26]||(e[26]=R("Deadline ",-1)),_(a("input",{type:"date","onUpdate:modelValue":o=>s.deadline=o,class:"w-full border rounded p-1 text-xs"},null,8,Wt),[[ne,s.deadline]])])]),a("div",Qt,[x($,{small:"",color:"secondary",outline:"",label:"Remove",onClick:o=>de(s.id)},null,8,["onClick"])])],40,jt))),128))],512),h.value.standards?(l(),r("div",Gt,n(h.value.standards),1)):v("",!0),b.value.length?v("",!0):(l(),r("div",Ht," Drag standards here or click Add")),a("div",Jt,[x($,{small:"",color:"primary",outline:"",disabled:!b.value.length,label:"Next: Supervisors",onClick:J},null,8,["disabled"])])])],32)],2)]),a("div",{class:z(["px-4 sm:px-6 pb-4",D.value>=4?"opacity-100":"opacity-50 pointer-events-none"])},[a("div",Xt,[e[27]||(e[27]=a("div",{class:"px-3 py-2 border-b font-medium text-sm"},"Supervisors (required)",-1)),a("div",Zt,[_(a("input",{ref_key:"evaluatorInputRef",ref:_e,"onUpdate:modelValue":e[10]||(e[10]=s=>Z.value=s),onInput:Ve,class:"w-full border p-2 rounded",placeholder:"Search users by username"},null,544),[[ne,Z.value]]),Z.value?(l(),r("div",ea,[E.value?(l(),r("div",ta,"Searching...")):(l(),r(g,{key:1},[(l(!0),r(g,null,f(ie.value,s=>(l(),r("div",{key:s.id,class:"p-2 text-sm flex items-center justify-between hover:bg-gray-50"},[a("div",aa,"@"+n(s.username)+" — "+n(s.first_name||"")+" "+n(s.last_name||""),1),x($,{small:"",color:"primary",outline:"",label:"Add",onClick:o=>Ee(s)},null,8,["onClick"])]))),128)),ie.value.length?v("",!0):(l(),r("div",sa,"No results"))],64))])):v("",!0),a("div",la,[(l(!0),r(g,null,f(T.value,s=>(l(),r("span",{key:s.id,class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},[R(" @"+n(s.username)+" ",1),a("button",{class:"ml-1 text-indigo-600 hover:text-indigo-800",onClick:te(o=>i(s),["prevent"])},"×",8,ra)]))),128))])])])],2),a("div",ia,[e[28]||(e[28]=a("div",{class:"text-xs text-gray-500"},"Tip: Department → Assignee → Standards → Supervisors. Drag items to the right to select.",-1)),a("div",na,[x($,{color:"secondary",outline:"",label:"Cancel",onClick:X}),x($,{disabled:H.value,label:H.value?"Creating…":`Create ${b.value.length||""}`,color:"primary",onClick:Ae},null,8,["disabled","label"])])])])])):v("",!0)]),_:1}))}},da=Ye(oa,[["__scopeId","data-v-875a37c6"]]),ua={class:"mb-3 flex items-center justify-between"},ca={class:"flex items-center gap-2"},va={class:"flex items-center gap-2"},ma={class:"rounded-2xl border bg-white shadow-sm mb-3 p-4"},pa={class:"grid grid-cols-1 md:grid-cols-6 gap-3"},ga={key:0,value:""},fa=["value"],ya=["value"],_a=["disabled"],xa={key:0,value:""},ba=["value"],wa=["value"],ha=["value"],ka=["value"],Sa=["value"],$a={class:"text-sm text-gray-900"},Ca={key:0,class:"text-xs text-gray-500 line-clamp-2"},Da={class:"text-xs text-gray-700 flex items-center gap-2"},Aa={class:"text-[11px] text-gray-500"},La={class:"text-xs"},Va={class:"text-[11px] text-gray-500"},Ea={class:"text-xs"},Ua={class:"text-xs"},Na={class:"flex justify-end gap-1"},Ia={key:0,class:"fixed inset-0 bg-black/30 z-50 grid place-items-center"},Ma={class:"bg-white rounded-2xl shadow-xl w-full max-w-5xl"},Ta={class:"px-4 sm:px-6 py-3 border-b flex items-center justify-between"},Ra={class:"text-lg font-semibold"},Pa={class:"p-4 sm:p-6 space-y-3 max-h-[70vh] overflow-y-auto"},ja={class:"grid grid-cols-1 gap-3"},Oa={key:0},qa=["disabled"],Ba=["value"],Ya={key:0,class:"text-xs text-red-600"},Fa={key:1},za=["disabled"],Ka=["value"],Wa={key:2},Qa={class:"flex items-center gap-2 mb-2"},Ga={class:"max-h-40 overflow-auto border rounded"},Ha={key:0,class:"p-2 text-xs text-gray-500"},Ja={key:1},Xa={class:"truncate"},Za={key:0,class:"p-2 text-xs text-gray-500"},es={class:"flex flex-wrap gap-2 mt-2"},ts=["onClick"],as={key:0,class:"text-xs text-red-600"},ss={key:3,class:"border rounded p-2"},ls={key:0},rs={class:"md:col-span-1 whitespace-normal break-words"},is=["onUpdate:modelValue"],ns=["value"],os=["onUpdate:modelValue"],ds=["value"],us=["onUpdate:modelValue"],cs={key:0,class:"text-right"},vs={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2"},ms=["value"],ps={key:0,class:"text-xs text-red-600"},gs=["value"],fs={class:"flex gap-2 mb-2"},ys={key:0,class:"max-h-36 overflow-auto border rounded mb-2"},_s={key:0,class:"p-2 text-xs text-gray-500"},xs={key:1},bs={class:"truncate"},ws={key:0,class:"p-2 text-xs text-gray-500"},hs={class:"flex flex-wrap gap-2"},ks=["onClick"],Ss={class:"pt-2 flex justify-end"},$s={__name:"EvaluationsManagementPage",setup(Me){const w=Oe(),B=qe(),K=Pe(),L=U(()=>String(K.user?.role||"").toLowerCase()==="admin"),C=d([]),ae=U(()=>Number(c.value.department_id||0)||null),oe=U(()=>{const i=(C.value||[]).find(t=>Number(t.id)===ae.value);return String(i?.membership?.role||i?.UserDepartment?.role||i?.user_department?.role||"").toLowerCase()}),se=U(()=>(C.value||[]).filter(i=>String(i?.membership?.role||i?.UserDepartment?.role||i?.user_department?.role||"").toLowerCase()==="supervisor")),W=U(()=>L.value?"admin":oe.value==="supervisor"?"supervisor":"member"),Y=U(()=>{const i=new Map;return(C.value||[]).forEach(t=>{const e=String(t?.membership?.role||t?.UserDepartment?.role||t?.user_department?.role||"").toLowerCase();t?.id&&i.set(Number(t.id),e)}),i}),ye=U(()=>L.value||(C.value||[]).some(i=>String(i?.membership?.role||"").toLowerCase()==="supervisor")),ce=["in_progress","complied","not_complied"],u=["low","medium","high","urgent"],h=["1st Semester","2nd Semester","Summer"],D=(()=>{const i=new Date().getFullYear();return Array.from({length:6},(t,e)=>`${i+e}-${i+e+1}`)})(),c=d({page:1,limit:10,department_id:"",assigned_to_id:"",status:"",priority:"",academic_year:"",semester:""}),V=async(i={},t=!0)=>{c.value={...c.value,...i};const e={...c.value};["department_id","assigned_to_id","status","priority","academic_year","semester"].forEach(s=>{(e[s]===""||e[s]==null)&&delete e[s]}),!L.value&&W.value==="member"&&K.user?.id&&(e.assigned_to_id=Number(K.user.id)),await w.fetchAll(e,t)};Ne(async()=>{if(await B.fetchAll({page:1,limit:100},!0),!L.value&&K.user?.id)try{C.value=await Ie.getDepartments(K.user.id)}catch{}const i=(C.value||[]).some(t=>String(t?.membership?.role||t?.UserDepartment?.role||t?.user_department?.role||"").toLowerCase()==="supervisor");if(!L.value&&i){if(!c.value.department_id){const t=(C.value||[]).find(e=>String(e?.membership?.role||e?.UserDepartment?.role||e?.user_department?.role||"").toLowerCase()==="supervisor");t?.id&&(c.value.department_id=Number(t.id))}!c.value.academic_year&&Array.isArray(D)&&D.length&&(c.value.academic_year=D[0]),c.value.semester||(c.value.semester="1st Semester")}await V({page:1,limit:10},!0)});const P=d([]),ve=d(!1),_e=async()=>{if(P.value=[],!!c.value.department_id){ve.value=!0;try{const i=await B.fetchMembers(c.value.department_id,!0),t=Array.isArray(i)?i:[];P.value=L.value?t:t.filter(e=>String(e?.membership?.role||e?.UserDepartment?.role||e?.user_department?.role||"").toLowerCase()==="member")}finally{ve.value=!1}}};O(()=>c.value.department_id,async()=>{c.value.assigned_to_id="",await _e(),W.value==="supervisor"&&Array.isArray(P.value)&&P.value.length&&(c.value.assigned_to_id=P.value[0].id),await V({page:1},!0)}),O(()=>c.value.assigned_to_id,async()=>{await V({page:1},!0)}),O(()=>c.value.status,async()=>{await V({page:1},!0)}),O(()=>c.value.priority,async()=>{await V({page:1},!0)}),O(()=>c.value.academic_year,async()=>{await V({page:1},!0)}),O(()=>c.value.semester,async()=>{await V({page:1},!0)});const xe=U(()=>({total:w.list.total||0,totalPages:w.list.totalPages||1,currentPage:w.list.currentPage||1,pageSize:w.list.pageSize||10,data:w.list.data||[]})),le=[{key:"standard",label:"Standard",sortable:!1,minWidth:260},{key:"status",label:"Status",sortable:!0,width:100},{key:"priority",label:"Priority",sortable:!0,width:100},{key:"acad",label:"A.Y./Sem",sortable:!1,width:140},{key:"assignee",label:"Assignee",sortable:!1,minWidth:180},{key:"deadline",label:"Deadline",sortable:!0,width:140}],me=i=>B.departments?.data?.find(e=>e.id===i)?.name||"-",re=i=>{const t=String(i||"").toLowerCase();return t==="governance"?"bg-indigo-50 text-indigo-700 ring-indigo-200":t==="records"?"bg-amber-50 text-amber-700 ring-amber-200":t==="processes"?"bg-sky-50 text-sky-700 ring-sky-200":t==="quality"?"bg-emerald-50 text-emerald-700 ring-emerald-200":t==="resources"?"bg-purple-50 text-purple-700 ring-purple-200":"bg-gray-50 text-gray-700 ring-gray-200"},Q=d(!1),y=d("create"),p=d({id:null,standard_id:"",department_id:"",academic_year:"",semester:"",assigned_to_id:""}),N=d({}),q=d([]),b=U(()=>{const i=String(j.value||"").toLowerCase(),t=new Set((k.value||[]).map(s=>s.id)),e=(q.value||[]).filter(s=>!t.has(s.id));return i?e.filter(s=>String(s.description||"").toLowerCase().includes(i)||String(s.id).includes(i)):e}),k=d([]),G=d(!1),j=d(""),M=d([]),be=U(()=>(M.value||[]).filter(i=>String(i?.membership?.role||"").toLowerCase()==="member")),we=d(!1),pe=async()=>{if(q.value=[],!!p.value.department_id){G.value=!0;try{const i=await Be.list({department_id:p.value.department_id,limit:100});q.value=Array.isArray(i?.data)?i.data:[]}finally{G.value=!1}}},he=i=>{!i||!i.id||k.value.find(t=>t.id===i.id)||k.value.push({id:i.id,description:i.description,status:"in_progress",priority:"medium",deadline:(()=>{const t=new Date;t.setDate(t.getDate()+1);const e=s=>String(s).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`})()})},ge=i=>{k.value=k.value.filter(t=>t.id!==i)},de=async()=>{if(M.value=[],!!p.value.department_id){we.value=!0;try{const i=await B.fetchMembers(p.value.department_id,!0);M.value=Array.isArray(i)?i:[]}finally{we.value=!1}}},Ce=async()=>{y.value="create",p.value={id:null,standard_id:"",department_id:"",academic_year:"",semester:"",assigned_to_id:""},N.value={},Q.value=!0,E.value=[],J.value="",X.value=[],k.value=[],M.value=[],q.value=[],j.value="",await pe(),await de()},ke=async i=>{if(!L.value&&Y.value.get(Number(i.department_id))!=="supervisor")return;await w.fetchById(i.id);const t=w.selected||i;y.value="edit",p.value={id:t.id,standard_id:t.standard_id,department_id:t.department_id,academic_year:t.academic_year||D[0]||"",semester:t.semester||"",assigned_to_id:t.assigned_to_id||""},N.value={},Q.value=!0,k.value=[{id:t.standard_id,description:t.standard?.description||"",status:t.status,priority:t.priority,deadline:t.deadline?new Date(t.deadline).toISOString().slice(0,10):""}],await pe(),await de(),await Ee(t.id)},Se=()=>{const i={};return p.value.department_id||(i.department_id="Department is required"),!k.value.length&&!p.value.standard_id&&(i.standard_id="At least one standard is required"),p.value.academic_year?.trim()||(i.academic_year="Academic year is required"),N.value=i,Object.keys(i).length===0},$e=async()=>{if(!Se())return;const i={academic_year:p.value.academic_year.trim(),semester:p.value.semester||null,assigned_to_id:p.value.assigned_to_id?Number(p.value.assigned_to_id):null};if(y.value==="create"){const t=k.value.length?k.value:p.value.standard_id?[{id:Number(p.value.standard_id),status:"in_progress",priority:"medium",deadline:(()=>{const s=new Date;s.setDate(s.getDate()+1);const o=m=>String(m).padStart(2,"0");return`${s.getFullYear()}-${o(s.getMonth()+1)}-${o(s.getDate())}`})()}]:[],e=[];for(const s of t){const o=await w.create({...i,status:s.status||"in_progress",priority:s.priority||"medium",deadline:s.deadline?new Date(s.deadline):(function(){const m=new Date;return m.setDate(m.getDate()+1),m})(),standard_id:Number(s.id)});o?.id&&(e.push(o.id),E.value.length&&await w.setEvaluators(o.id,E.value.map(m=>m.id)))}}else{const t=k.value[0]||{id:p.value.standard_id,status:"in_progress",priority:"medium",deadline:null},e=await w.updateById(p.value.id,{...i,status:t.status||"in_progress",priority:t.priority||"medium",deadline:t.deadline?new Date(t.deadline):(function(){const s=new Date;return s.setDate(s.getDate()+1),s})(),standard_id:Number(t.id)});E.value.length&&e?.id&&await w.setEvaluators(e.id,E.value.map(s=>s.id))}Q.value=!1,await V({},!0)},De=async i=>{!L.value&&Y.value.get(Number(i.department_id))!=="supervisor"||!(await Te.fire({title:"Delete evaluation?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete"})).isConfirmed||(await w.deleteById(i.id),await V({},!0),await Te.fire("Deleted","Evaluation removed.","success"))},ue=d(!1),fe=d(!1),H=()=>{try{fe.value=window.matchMedia("(min-width: 1024px)").matches}catch{fe.value=!0}};Ne(()=>{H(),window.addEventListener("resize",H)}),Ke(()=>{window.removeEventListener("resize",H)});const Ae=()=>{fe.value?ue.value=!0:Ce()},Le=async()=>{ue.value=!1,await V({},!0)},J=d(""),X=d([]),Z=d(!1),E=d([]),ie=async()=>{const i=(J.value||"").trim().toLowerCase(),t=new Set((E.value||[]).map(o=>o.id)),e=(M.value||[]).filter(o=>String(o?.membership?.role||"").toLowerCase()==="supervisor"),s=i?e.filter(o=>String(o.username||"").toLowerCase().includes(i)||String(o.first_name||"").toLowerCase().includes(i)||String(o.last_name||"").toLowerCase().includes(i)):e;X.value=s.filter(o=>!t.has(o.id)).slice(0,20)},T=i=>{!i||!i.id||(E.value.find(t=>t.id===i.id)||E.value.push(i),J.value="",X.value=[])},Ve=i=>{E.value=E.value.filter(t=>t.id!==i.id)},Ee=async i=>{try{const t=await w.fetchEvaluators(i);E.value=Array.isArray(t)?t:[]}catch{E.value=[]}};return(i,t)=>(l(),ee(We,null,{default:A(()=>[x(Qe,null,{default:A(()=>[W.value==="member"?(l(),ee(Ue,{key:0,color:"info",class:"mb-3"},{default:A(()=>[...t[18]||(t[18]=[R(" You are viewing your assigned evaluations only. ",-1)])]),_:1})):W.value==="supervisor"?(l(),ee(Ue,{key:1,color:"info",class:"mb-3"},{default:A(()=>[...t[19]||(t[19]=[R(" You are viewing supervisor mode — department-wide evaluations. ",-1)])]),_:1})):v("",!0),x(et,{icon:I(Ge),title:"Evaluations",main:""},{default:A(()=>[...t[20]||(t[20]=[R(" Track and assign compliance evaluations ",-1)])]),_:1},8,["icon"]),a("div",ua,[a("div",ca,[ye.value?(l(),ee($,{key:0,icon:I(He),color:"primary",label:"New Evaluation",onClick:Ae},null,8,["icon"])):v("",!0)]),a("div",va,[x($,{icon:I(Je),color:"info",label:"Refresh",onClick:t[0]||(t[0]=()=>V({},!0))},null,8,["icon"])])]),I(w).error?(l(),ee(Ue,{key:2,color:"danger"},{default:A(()=>[R(n(I(w).error),1)]),_:1})):v("",!0),a("div",ma,[a("div",pa,[a("div",null,[t[21]||(t[21]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Department",-1)),_(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.value.department_id=e),class:"w-full border p-2 rounded"},[L.value?(l(),r("option",ga,"All")):v("",!0),L.value?(l(!0),r(g,{key:1},f(I(B).departments.data,e=>(l(),r("option",{key:e.id,value:e.id},n(e.name),9,fa))),128)):(l(!0),r(g,{key:2},f(se.value,e=>(l(),r("option",{key:"myDept-"+e.id,value:e.id},n(e.name),9,ya))),128))],512),[[S,c.value.department_id]])]),a("div",null,[t[22]||(t[22]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Assignee",-1)),_(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.value.assigned_to_id=e),class:"w-full border p-2 rounded",disabled:!c.value.department_id},[L.value?(l(),r("option",xa,"All")):v("",!0),(l(!0),r(g,null,f(P.value,e=>(l(),r("option",{key:e.id,value:e.id},"@"+n(e.username)+" "+n(e.first_name||"")+" "+n(e.last_name||""),9,ba))),128))],8,_a),[[S,c.value.assigned_to_id]])]),a("div",null,[t[23]||(t[23]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"A.Y.",-1)),_(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>c.value.academic_year=e),class:"w-full border p-2 rounded"},[(l(!0),r(g,null,f(I(D),e=>(l(),r("option",{key:e,value:e},n(e),9,wa))),128))],512),[[S,c.value.academic_year]])]),a("div",null,[t[24]||(t[24]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Semester",-1)),_(a("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>c.value.semester=e),class:"w-full border p-2 rounded"},[(l(),r(g,null,f(h,e=>a("option",{key:e,value:e},n(e),9,ha)),64))],512),[[S,c.value.semester]])]),a("div",null,[t[26]||(t[26]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Status",-1)),_(a("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>c.value.status=e),class:"w-full border p-2 rounded"},[t[25]||(t[25]=a("option",{value:""},"All",-1)),(l(),r(g,null,f(ce,e=>a("option",{key:e,value:e},n(e),9,ka)),64))],512),[[S,c.value.status]])]),a("div",null,[t[28]||(t[28]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Priority",-1)),_(a("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>c.value.priority=e),class:"w-full border p-2 rounded"},[t[27]||(t[27]=a("option",{value:""},"All",-1)),(l(),r(g,null,f(u,e=>a("option",{key:e,value:e},n(e),9,Sa)),64))],512),[[S,c.value.priority]])])])]),x(tt,{columns:le,data:xe.value,loading:I(w).isLoading,onQueryChange:t[7]||(t[7]=e=>V(e,!0))},{"cell-title":A(({row:e})=>[a("div",$a,n(e.title||"(no title)"),1),e.description?(l(),r("div",Ca,n(e.description),1)):v("",!0)]),"cell-standard":A(({row:e})=>[a("div",Da,[a("span",null,n(e.standard?.description||"-"),1),e.standard?.area?(l(),r("span",{key:0,class:z(["inline-flex items-center rounded-full px-2 py-[2px] text-[11px] ring-1",re(e.standard.area)])},n(e.standard.area),3)):v("",!0)]),a("div",Aa,"Dept: "+n(me(e.department_id)),1)]),"cell-status":A(({row:e})=>[x(Re,{text:e.status,tone:e.status==="complied"?"emerald":e.status==="in_progress"?"indigo":"gray"},null,8,["text","tone"])]),"cell-priority":A(({row:e})=>[x(Re,{text:e.priority,tone:e.priority==="high"||e.priority==="urgent"?"orange":"gray"},null,8,["text","tone"])]),"cell-acad":A(({row:e})=>[a("div",La,n(e.academic_year||"-"),1),a("div",Va,n(e.semester||""),1)]),"cell-assignee":A(({row:e})=>[a("div",Ea,n(e.assignee?"@"+e.assignee.username:"-"),1)]),"cell-deadline":A(({row:e})=>[a("div",Ua,n(e.deadline?new Date(e.deadline).toLocaleDateString():"-"),1)]),"cell-actions":A(({row:e})=>[a("div",Na,[L.value||Y.value.get(Number(e.department_id))==="supervisor"?(l(),ee($,{key:0,icon:I(Xe),small:"",color:"secondary",outline:"",onClick:s=>ke(e)},null,8,["icon","onClick"])):v("",!0),L.value||Y.value.get(Number(e.department_id))==="supervisor"?(l(),ee($,{key:1,icon:I(Ze),small:"",color:"danger",outline:"",onClick:s=>De(e)},null,8,["icon","onClick"])):v("",!0)])]),default:A(()=>[t[29]||(t[29]=a("div",{class:"hidden"},[a("span",{class:"bg-indigo-50 text-indigo-700 ring-indigo-200"}),a("span",{class:"bg-amber-50 text-amber-700 ring-amber-200"}),a("span",{class:"bg-sky-50 text-sky-700 ring-sky-200"}),a("span",{class:"bg-emerald-50 text-emerald-700 ring-emerald-200"}),a("span",{class:"bg-purple-50 text-purple-700 ring-purple-200"}),a("span",{class:"bg-gray-50 text-gray-700 ring-gray-200"})],-1))]),_:1},8,["data","loading"]),x(je,{name:"fade"},{default:A(()=>[Q.value?(l(),r("div",Ia,[a("div",Ma,[a("div",Ta,[a("h3",Ra,n(y.value==="create"?"Create Evaluation":"Edit Evaluation"),1),x($,{label:"Close",color:"secondary",outline:"",small:"",onClick:t[8]||(t[8]=e=>Q.value=!1)})]),a("div",Pa,[a("div",ja,[y.value==="create"?(l(),r("div",Oa,[t[31]||(t[31]=a("label",{class:"block text-sm mb-1"},"Department",-1)),_(a("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>p.value.department_id=e),class:"w-full border p-2 rounded",disabled:y.value==="edit",onChange:t[10]||(t[10]=()=>{pe(),de()})},[t[30]||(t[30]=a("option",{value:""},"-",-1)),(l(!0),r(g,null,f(I(B).departments.data,e=>(l(),r("option",{key:e.id,value:e.id},n(e.name),9,Ba))),128))],40,qa),[[S,p.value.department_id]]),N.value.department_id?(l(),r("div",Ya,n(N.value.department_id),1)):v("",!0)])):v("",!0),y.value==="create"?(l(),r("div",Fa,[t[33]||(t[33]=a("label",{class:"block text-sm mb-1"},"Assignee",-1)),_(a("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>p.value.assigned_to_id=e),class:"w-full border p-2 rounded",disabled:y.value==="edit"},[t[32]||(t[32]=a("option",{value:""},"-",-1)),(l(!0),r(g,null,f(be.value,e=>(l(),r("option",{key:e.id,value:e.id},"@"+n(e.username)+" "+n(e.first_name||"")+" "+n(e.last_name||""),9,Ka))),128))],8,za),[[S,p.value.assigned_to_id]])])):v("",!0),y.value==="create"?(l(),r("div",Wa,[t[34]||(t[34]=a("label",{class:"block text-sm mb-1"},[R("Standards "),a("span",{class:"text-red-500"},"*")],-1)),a("div",Qa,[_(a("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>j.value=e),class:"flex-1 border p-2 rounded",placeholder:"Search standards..."},null,512),[[ne,j.value]]),x($,{small:"",color:"primary",outline:"",label:"Add All",onClick:t[13]||(t[13]=()=>{b.value.forEach(he)})})]),a("div",Ga,[G.value?(l(),r("div",Ha,"Loading...")):(l(),r("div",Ja,[(l(!0),r(g,null,f(b.value,e=>(l(),r("div",{key:e.id,class:"p-2 text-sm flex items-center justify-between hover:bg-gray-50"},[a("div",Xa,"#"+n(e.id)+" "+n(e.description),1),x($,{small:"",color:"primary",outline:"",label:"Add",onClick:s=>he(e)},null,8,["onClick"])]))),128)),b.value.length?v("",!0):(l(),r("div",Za,"No standards"))]))]),a("div",es,[(l(!0),r(g,null,f(k.value,e=>(l(),r("span",{key:e.id,class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-[2px] text-[11px] text-blue-700 ring-1 ring-blue-200"},[R(" #"+n(e.id)+" ",1),a("button",{class:"ml-1 text-blue-700 hover:text-blue-900",onClick:te(s=>ge(e.id),["prevent"])},"×",8,ts)]))),128))]),N.value.standard_id?(l(),r("div",as,n(N.value.standard_id),1)):v("",!0)])):v("",!0),k.value.length?(l(),r("div",ss,[t[39]||(t[39]=a("div",{class:"text-xs font-medium text-gray-700 mb-2"},"Per-standard settings",-1)),a("div",{class:z(["grid grid-cols-1 gap-2 text-xs",y.value==="create"?"md:grid-cols-5":"md:grid-cols-4"])},[t[35]||(t[35]=a("div",{class:"font-semibold"},"Standard",-1)),t[36]||(t[36]=a("div",{class:"font-semibold"},"Status",-1)),t[37]||(t[37]=a("div",{class:"font-semibold"},"Priority",-1)),t[38]||(t[38]=a("div",{class:"font-semibold"},"Deadline",-1)),y.value==="create"?(l(),r("div",ls)):v("",!0),(l(!0),r(g,null,f(k.value,(e,s)=>(l(),r(g,{key:e.id},[a("div",rs,"#"+n(e.id)+" "+n(e.description||""),1),a("div",null,[_(a("select",{"onUpdate:modelValue":o=>e.status=o,class:"w-full border p-1 rounded"},[(l(),r(g,null,f(ce,o=>a("option",{key:o,value:o},n(o),9,ns)),64))],8,is),[[S,e.status]])]),a("div",null,[_(a("select",{"onUpdate:modelValue":o=>e.priority=o,class:"w-full border p-1 rounded"},[(l(),r(g,null,f(u,o=>a("option",{key:o,value:o},n(o),9,ds)),64))],8,os),[[S,e.priority]])]),a("div",null,[_(a("input",{type:"date","onUpdate:modelValue":o=>e.deadline=o,class:"w-full border p-1 rounded"},null,8,us),[[ne,e.deadline]])]),y.value==="create"?(l(),r("div",cs,[x($,{small:"",color:"danger",outline:"",label:"Remove",onClick:o=>ge(e.id)},null,8,["onClick"])])):v("",!0)],64))),128))],2)])):v("",!0)]),a("div",vs,[a("div",null,[t[40]||(t[40]=a("label",{class:"block text-sm mb-1"},[R("Academic Year "),a("span",{class:"text-red-500"},"*")],-1)),_(a("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>p.value.academic_year=e),class:"w-full border p-2 rounded"},[(l(!0),r(g,null,f(I(D),e=>(l(),r("option",{key:e,value:e},n(e),9,ms))),128))],512),[[S,p.value.academic_year]]),N.value.academic_year?(l(),r("div",ps,n(N.value.academic_year),1)):v("",!0)]),a("div",null,[t[42]||(t[42]=a("label",{class:"block text-sm mb-1"},"Semester",-1)),_(a("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>p.value.semester=e),class:"w-full border p-2 rounded"},[t[41]||(t[41]=a("option",{value:""},"-",-1)),(l(),r(g,null,f(h,e=>a("option",{key:e,value:e},n(e),9,gs)),64))],512),[[S,p.value.semester]])])]),a("div",null,[t[43]||(t[43]=a("label",{class:"block text-sm mb-1"},"Supervisors (multi)",-1)),a("div",fs,[_(a("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>J.value=e),onInput:ie,class:"flex-1 border p-2 rounded",placeholder:"Search users by username"},null,544),[[ne,J.value]])]),J.value?(l(),r("div",ys,[Z.value?(l(),r("div",_s,"Searching...")):(l(),r("div",xs,[(l(!0),r(g,null,f(X.value,e=>(l(),r("div",{key:e.id,class:"p-2 text-sm flex items-center justify-between hover:bg-gray-50"},[a("div",bs,"@"+n(e.username)+" "+n(e.first_name||"")+" "+n(e.last_name||""),1),x($,{small:"",color:"primary",outline:"",label:"Add",onClick:s=>T(e)},null,8,["onClick"])]))),128)),X.value.length?v("",!0):(l(),r("div",ws,"No results"))]))])):v("",!0),a("div",hs,[(l(!0),r(g,null,f(E.value,e=>(l(),r("span",{key:e.id,class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},[R(" @"+n(e.username)+" ",1),a("button",{class:"ml-1 text-indigo-600 hover:text-indigo-800",onClick:te(s=>Ve(e),["prevent"])},null,8,ks)]))),128))])]),a("div",Ss,[x($,{color:"primary",label:y.value==="create"?"Create":"Save Changes",onClick:$e},null,8,["label"])])])])])):v("",!0)]),_:1}),x(da,{modelValue:ue.value,"onUpdate:modelValue":t[17]||(t[17]=e=>ue.value=e),onSubmitted:Le},null,8,["modelValue"])]),_:1})]),_:1}))}},Rs=Ye($s,[["__scopeId","data-v-3801aac4"]]);export{Rs as default};
