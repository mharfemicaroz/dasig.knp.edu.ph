import{u as Y,c as D,r as g,o as H,B as A,b as r,m as d,g as p,f as a,e as m,h as u,l as T,t as o,i as v,v as V,a as n,F as y,C as _,D as P,T as J,H as K,S as $}from"./index.D6qiF35X.js";import{w as X,_ as Z,S as ee,b as te,q as ae,p as se,g as le,s as re}from"./SectionMain.LQE99ZwY.js";import{_ as ie,a as ne}from"./NotificationBar.DxHywnn9.js";import{B as oe}from"./BaseTable.Dw-ahIFq.js";import{_ as b}from"./BaseButton.CMgDjKct.js";import{_ as de}from"./Badge.BDCNorzU.js";import{u as ue}from"./standard.p4IGdx9C.js";import{u as ce}from"./department.C1lO3iao.js";import{_ as pe}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./BaseIcon.B-kGt5NE.js";const me={class:"mb-3 flex items-center justify-between"},ve={class:"flex items-center gap-2"},fe={class:"flex items-center gap-2"},ye={class:"rounded-2xl border bg-white shadow-sm mb-3 p-4"},_e={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},be={id:"areas"},xe=["value"],ge=["value"],ke=["value"],we={class:"flex items-end"},Se={class:"text-sm text-gray-900"},he={class:"inline-flex items-center rounded-full bg-gray-50 px-2 py-[2px] text-[11px] text-gray-700 ring-1 ring-gray-200"},Ce={class:"inline-flex items-center rounded-full bg-indigo-50 px-2 py-[2px] text-[11px] text-indigo-700 ring-1 ring-indigo-200"},De={class:"text-sm text-gray-900"},Ae={class:"flex justify-end gap-1"},Be={key:0,class:"fixed inset-0 bg-black/30 z-50 grid place-items-center"},Te={class:"bg-white rounded-2xl shadow-xl w-full max-w-2xl"},Ve={class:"px-4 sm:px-6 py-3 border-b flex items-center justify-between"},Ne={class:"text-lg font-semibold"},Me={class:"p-4 sm:p-6 space-y-3"},Pe=["value"],Ee=["value"],Ue={key:0,class:"text-xs text-red-600"},$e={key:0,class:"text-xs text-red-600"},Le={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Ie={id:"areas-edit"},je=["value"],Ge=["value"],Re={class:"flex items-center gap-2 mt-6"},qe={class:"pt-2 flex justify-end"},Fe={key:0,class:"text-xs text-amber-600"},ze={__name:"StandardsManagementPage",setup(Oe){const i=ue(),B=ce(),N=Y(),k=D(()=>String(N.user?.role||"").toLowerCase()==="admin"),w=g([]),M=["Governance","Records","Processes","Quality","Resources"],L=[{label:"core",value:"core"},{label:"core function",value:"core function"},{label:"extra",value:"extra"}],c=g({page:1,limit:10,description:"",area:"",department_id:""}),x=async(s={},t=!0)=>{c.value={...c.value,...s};const e={...c.value};["description","area","department_id"].forEach(C=>{(e[C]===""||e[C]==null)&&delete e[C]}),await i.fetchAll(e,t)};H(async()=>{if(await B.fetchAll({page:1,limit:100},!0),!k.value&&N.user?.id)try{w.value=await X.getDepartments(N.user.id)}catch{}await x({page:1,limit:10},!0)});const I=D(()=>({total:i.list.total||0,totalPages:i.list.totalPages||1,currentPage:i.list.currentPage||1,pageSize:i.list.pageSize||10,data:Array.isArray(i.list.data)?i.list.data:[]})),j=D(()=>{const s=new Map;return(w.value||[]).forEach(t=>{const e=String(t?.membership?.role||t?.UserDepartment?.role||t?.user_department?.role||"").toLowerCase();t?.id&&s.set(Number(t.id),e)}),s}),G=D(()=>k.value||(w.value||[]).some(s=>String(s?.membership?.role||"").toLowerCase()==="supervisor")),E=s=>k.value?!0:j.value.get(Number(s?.department_id))==="supervisor",R=[{key:"description",label:"Description",sortable:!1,minWidth:280},{key:"area",label:"Area",sortable:!0,width:140},{key:"type",label:"Type",sortable:!0,width:140},{key:"department",label:"Department",sortable:!1,minWidth:200},{key:"is_active",label:"Active",sortable:!0,width:90}],q=s=>B.departments?.data?.find(e=>e.id===s)?.name||`#${s}`,S=g(!1),h=g("create"),l=g({id:null,description:"",area:"Governance",type:"core",is_active:!0,department_id:""}),f=g({}),F=()=>{h.value="create",l.value={id:null,description:"",area:"Governance",type:"core",is_active:!0,department_id:""},f.value={},S.value=!0},z=async s=>{try{await i.fetchById(s.id);const t=i.selected||s;h.value="edit",l.value={id:t.id,description:t.description||"",area:t.area||"Governance",type:t.type||"core",is_active:!!t.is_active,department_id:t.department_id||""},f.value={},S.value=!0}catch{}},O=()=>{const s={};return l.value.description?.trim()||(s.description="Description is required"),l.value.department_id||(s.department_id="Department is required"),f.value=s,Object.keys(s).length===0},Q=async()=>{if(!O())return;const s={description:l.value.description.trim(),area:(l.value.area||"").trim(),type:(l.value.type||"").trim()||null,is_active:!!l.value.is_active,department_id:Number(l.value.department_id)};h.value==="create"?await i.create(s):await i.updateById(l.value.id,s),S.value=!1,await x({},!0)},W=async s=>{!s?.id||!(await $.fire({title:"Delete standard?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete"})).isConfirmed||(await i.deleteById(s.id),await x({},!0),await $.fire("Deleted","Standard removed.","success"))},U=D({get:()=>l.value.area||"",set:s=>{l.value.area=s}});return(s,t)=>(r(),A(Z,null,{default:d(()=>[p(ee,null,{default:d(()=>[p(ie,{icon:u(te),title:"Standards",main:""},{default:d(()=>[...t[12]||(t[12]=[T(" Manage standards and assignments ",-1)])]),_:1},8,["icon"]),a("div",me,[a("div",ve,[G.value?(r(),A(b,{key:0,icon:u(ae),color:"primary",label:"New Standard",onClick:F},null,8,["icon"])):m("",!0)]),a("div",fe,[p(b,{icon:u(se),color:"info",label:"Refresh",onClick:t[0]||(t[0]=()=>x({},!0))},null,8,["icon"])])]),u(i).error?(r(),A(ne,{key:0,color:"danger"},{default:d(()=>[T(o(u(i).error),1)]),_:1})):m("",!0),a("div",ye,[a("div",_e,[a("div",null,[t[13]||(t[13]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Description",-1)),v(a("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.value.description=e),class:"w-full border p-2 rounded",placeholder:"Search..."},null,512),[[V,c.value.description]])]),a("div",null,[t[14]||(t[14]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Area",-1)),v(a("input",{list:"areas","onUpdate:modelValue":t[2]||(t[2]=e=>c.value.area=e),class:"w-full border p-2 rounded",placeholder:"Area"},null,512),[[V,c.value.area]]),a("datalist",be,[(r(),n(y,null,_(M,e=>a("option",{key:e,value:e},null,8,xe)),64))])]),a("div",null,[t[16]||(t[16]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Department",-1)),v(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>c.value.department_id=e),class:"w-full border p-2 rounded"},[t[15]||(t[15]=a("option",{value:""},"All",-1)),k.value?(r(!0),n(y,{key:0},_(u(B).departments.data,e=>(r(),n("option",{key:e.id,value:e.id},o(e.name),9,ge))),128)):(r(!0),n(y,{key:1},_(w.value,e=>(r(),n("option",{key:e.id,value:e.id},o(e.name),9,ke))),128))],512),[[P,c.value.department_id]])]),a("div",we,[p(b,{color:"primary",label:"Apply",class:"w-full",onClick:t[4]||(t[4]=()=>x({page:1},!0))})])])]),p(oe,{columns:R,data:I.value,loading:u(i).isLoading,onQueryChange:t[5]||(t[5]=e=>x(e,!0))},{"cell-description":d(({row:e})=>[a("div",Se,o(e.description),1)]),"cell-area":d(({row:e})=>[a("span",he,o(e.area||"-"),1)]),"cell-type":d(({row:e})=>[a("span",Ce,o(e.type||"-"),1)]),"cell-department":d(({row:e})=>[a("div",De,o(e.department_id?q(e.department_id):"-"),1)]),"cell-is_active":d(({row:e})=>[p(de,{text:e.is_active?"Yes":"No",tone:e.is_active?"emerald":"gray"},null,8,["text","tone"])]),"cell-actions":d(({row:e})=>[a("div",Ae,[E(e)?(r(),A(b,{key:0,icon:u(le),small:"",color:"secondary",outline:"",onClick:C=>z(e)},null,8,["icon","onClick"])):m("",!0),E(e)?(r(),A(b,{key:1,icon:u(re),small:"",color:"danger",outline:"",onClick:C=>W(e)},null,8,["icon","onClick"])):m("",!0)])]),_:1},8,["data","loading"]),p(J,{name:"fade"},{default:d(()=>[S.value?(r(),n("div",Be,[a("div",Te,[a("div",Ve,[a("h3",Ne,o(h.value==="create"?"Create Standard":"Edit Standard"),1),p(b,{label:"Close",color:"secondary",outline:"",small:"",onClick:t[6]||(t[6]=e=>S.value=!1)})]),a("div",Me,[a("div",null,[t[18]||(t[18]=a("label",{class:"block text-sm mb-1"},[T("Department "),a("span",{class:"text-red-500"},"*")],-1)),v(a("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.department_id=e),class:"w-full border p-2 rounded"},[t[17]||(t[17]=a("option",{value:"",disabled:""},"Select department",-1)),k.value?(r(!0),n(y,{key:0},_(u(B).departments.data,e=>(r(),n("option",{key:e.id,value:e.id},o(e.name),9,Pe))),128)):(r(!0),n(y,{key:1},_(w.value,e=>(r(),n("option",{key:e.id,value:e.id},o(e.name),9,Ee))),128))],512),[[P,l.value.department_id]]),f.value.department_id?(r(),n("div",Ue,o(f.value.department_id),1)):m("",!0)]),a("div",null,[t[19]||(t[19]=a("label",{class:"block text-sm mb-1"},[T("Description "),a("span",{class:"text-red-500"},"*")],-1)),v(a("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.value.description=e),rows:"3",class:"w-full border p-2 rounded",placeholder:"Describe the standard..."},null,512),[[V,l.value.description]]),f.value.description?(r(),n("div",$e,o(f.value.description),1)):m("",!0)]),a("div",Le,[a("div",null,[t[20]||(t[20]=a("label",{class:"block text-sm mb-1"},"Area",-1)),v(a("input",{list:"areas-edit","onUpdate:modelValue":t[9]||(t[9]=e=>U.value=e),class:"w-full border p-2 rounded",placeholder:"e.g., Governance"},null,512),[[V,U.value]]),a("datalist",Ie,[(r(),n(y,null,_(M,e=>a("option",{key:e,value:e},null,8,je)),64))]),t[21]||(t[21]=a("div",{class:"text-[11px] text-gray-500 mt-1"},"Defaults provided; new area names allowed.",-1))]),a("div",null,[t[22]||(t[22]=a("label",{class:"block text-sm mb-1"},"Type",-1)),v(a("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>l.value.type=e),class:"w-full border p-2 rounded"},[(r(),n(y,null,_(L,e=>a("option",{key:e.value,value:e.value},o(e.label),9,Ge)),64))],512),[[P,l.value.type]])]),a("div",Re,[v(a("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>l.value.is_active=e),class:"h-4 w-4"},null,512),[[K,l.value.is_active]]),t[23]||(t[23]=a("label",{for:"is_active",class:"text-sm"},"Active",-1))])]),a("div",qe,[p(b,{color:"primary",label:h.value==="create"?"Create":"Save Changes",onClick:Q},null,8,["label"])]),M.includes(String(l.value.area||"").trim())?m("",!0):(r(),n("div",Fe," Note: Backend may restrict areas to defaults; new areas might require server updates. "))])])])):m("",!0)]),_:1})]),_:1})]),_:1}))}},at=pe(ze,[["__scopeId","data-v-667a32a0"]]);export{at as default};
