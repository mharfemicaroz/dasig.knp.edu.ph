import{u as X,r as h,o as Z,c as ee,a as i,b as o,f as m,h as u,m as g,e as l,t as p,g as c,k as b,v as w,F as C,D as A,C as E,l as f,B as S,q as le,E as se,G as ae,S as N}from"./index.BOknro1r.js";import{a as te,c as oe}from"./imageCompression.A--1eZQ5.js";import{u as ie,_ as re,l as ne,n as de,S as ue,o as ce,p as ve,q as me,m as pe,r as fe,g as be,s as we,t as _e}from"./SectionMain.B3hG14Sc.js";import{_ as ye}from"./SectionTitleLineWithButton.C7bxM_9h.js";import{B as xe}from"./BaseTable.Ckuo5fbK.js";import{_ as y}from"./BaseButton.w6EMXcGq.js";import{_ as ge}from"./NotificationBar.CM5Y_e5H.js";import{_ as q}from"./Badge.D_Oe_-0y.js";import"./BaseIcon.D7Rla7cl.js";import"./ToasterComponent.Dz5A3hFA.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const ke={class:"mb-4 grid grid-cols-1 sm:block"},he={class:"sm:flex sm:gap-2"},Ce=["value"],Ae=["value"],Ue={class:"flex items-center justify-between mb-2"},Ee={class:"text-sm text-gray-500"},Ve={class:"flex gap-2"},Be={class:"w-9 h-9 rounded-full overflow-hidden bg-gray-100 border"},Fe=["src"],Pe={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},$e={class:"inline-flex items-center gap-1"},Se={class:"w-3.5 h-3.5 opacity-70",viewBox:"0 0 24 24"},Ne=["d"],qe={class:"flex items-center gap-1"},je={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Te={class:"bg-white p-4 md:p-5 rounded-2xl shadow-xl w-[980px] max-h-screen overflow-auto"},De={class:"flex items-center justify-between mb-3"},Ie={class:"text-lg font-semibold"},Me={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},ze={class:"md:col-span-3"},Le=["disabled"],Re={key:0,class:"text-red-600 text-[11px] mt-1"},Oe={class:"md:col-span-3"},We=["disabled"],Qe={key:0,class:"text-red-600 text-[11px] mt-1"},Ke={key:0,class:"md:col-span-3"},Ye={key:0,class:"text-red-600 text-[11px] mt-1"},Ge={key:1,class:"md:col-span-3"},He={key:0,class:"text-red-600 text-[11px] mt-1"},Je={key:2,class:"md:col-span-3"},Xe={key:0,class:"text-red-600 text-[11px] mt-1"},Ze={key:3,class:"md:col-span-3"},el={key:0,class:"text-red-600 text-[11px] mt-1"},ll=["disabled"],sl=["disabled"],al=["disabled"],tl=["value"],ol={key:0,class:"text-red-600 text-[11px] mt-1"},il=["disabled"],rl=["disabled"],nl={class:"md:col-span-3"},dl=["disabled"],ul={key:0,class:"mt-4 p-3 rounded-xl border bg-white/70"},cl={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},vl={class:"block mb-1 inline-flex items-center gap-2"},ml={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},pl=["d"],fl={class:"flex items-center gap-3"},bl={class:"w-16 h-16 rounded-full overflow-hidden bg-gray-100 border"},wl=["src"],_l={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},yl=["disabled"],xl={class:"block mb-1 inline-flex items-center gap-2"},gl={class:"w-4 h-4 opacity-80",viewBox:"0 0 24 24"},kl=["d"],hl={class:"flex items-center gap-3"},Cl={class:"w-28 h-16 rounded-lg overflow-hidden bg-gray-100 border"},Al=["src"],Ul={key:1,class:"w-full h-full flex items-center justify-center text-[10px] text-gray-400"},El=["disabled"],Vl={class:"flex justify-end gap-2 mt-5"},zl={__name:"UserManagementPage",setup(Bl){const n=ie();X();const j=le(),_=h({page:1,limit:10,q:"",role:"",is_active:""}),V=["admin","user"],T=[{label:"All",value:""},{label:"Yes",value:"true"},{label:"No",value:"false"}],x=async(t={},e=!0)=>{_.value={..._.value,...t};const v={..._.value};["q","role","is_active"].forEach(a=>{(v[a]===""||v[a]==null)&&delete v[a]}),v.q&&(v.username=v.q,delete v.q),await n.fetchAll(v,e)};Z(async()=>{await x({page:1,limit:10},!0)});const B=ee(()=>({total:n.users.total||0,totalPages:n.users.totalPages||1,currentPage:n.users.currentPage||1,pageSize:n.users.pageSize||10,data:n.users.data||[]})),D=t=>t?"emerald":"zinc",I=t=>t?"indigo":"gray",M=[{key:"avatar",label:"Avatar",width:64,formatter:(t,e)=>e.avatar||null,sortable:!1},{key:"username",label:"Username",sortable:!0,minWidth:160},{key:"name",label:"Name",sortable:!1,minWidth:200,formatter:(t,e)=>`${e.first_name||""} ${e.last_name||""}`.trim()||"â€”"},{key:"email",label:"Email",sortable:!0,minWidth:220},{key:"role",label:"Role",sortable:!0,width:120},{key:"is_active",label:"Active",sortable:!0,width:100},{key:"twoFAEnabled",label:"2FA",sortable:!0,width:100}],z=async t=>{await x(t)},k=h(!1),r=h("create"),s=h({id:null,username:"",email:"",first_name:"",last_name:"",role:"user",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""}),d=h({}),L=()=>{r.value="create",s.value={id:null,username:"",email:"",first_name:"",last_name:"",role:"student",is_active:!0,twoFAEnabled:!1,bio:"",avatar:null,cover:null,password:"",confirm_password:""},d.value={},k.value=!0},R=async t=>{await n.fetchById(t.id);const e=n.selectedUser||t;r.value="view",s.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null,password:"",confirm_password:""},d.value={},k.value=!0,await $(e.id)},O=async t=>{await n.fetchById(t.id);const e=n.selectedUser||t;r.value="edit",s.value={id:e.id,username:e.username||"",email:e.email||"",first_name:e.first_name||"",last_name:e.last_name||"",role:e.role||"student",is_active:!!e.is_active,twoFAEnabled:!!e.twoFAEnabled,bio:e.bio||"",avatar:e.avatar||null,cover:e.cover||null},d.value={},k.value=!0,await $(e.id)},W=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(t||"").trim()),Q=()=>{const t={};return s.value.username?.trim()||(t.username="Username is required"),W(s.value.email)||(t.email="Valid email is required"),s.value.role?.trim()||(t.role="Role is required"),r.value==="create"?(s.value.password?.trim()||(t.password="Password is required"),(s.value.password||"").length<6&&(t.password="Password must be at least 6 chars"),(s.value.confirm_password||"")!==(s.value.password||"")&&(t.confirm_password="Passwords do not match")):r.value==="edit"&&(s.value.password?.length&&s.value.password.length<6&&(t.password="At least 6 chars"),s.value.password?.length&&s.value.confirm_password!==s.value.password&&(t.confirm_password="Passwords do not match")),d.value=t,Object.keys(t).length===0},K=async()=>{if(r.value==="view"||!Q())return;const t={username:s.value.username.trim(),email:s.value.email.trim(),first_name:s.value.first_name?.trim()||"",last_name:s.value.last_name?.trim()||"",role:s.value.role||"user",is_active:!!s.value.is_active,twoFAEnabled:!!s.value.twoFAEnabled,bio:s.value.bio||null};r.value==="create"?(t.password=s.value.password,await n.create(t)):(s.value.password&&(t.password=s.value.password),await n.updateById(s.value.id,t)),k.value=!1,await x({},!0)},Y=async t=>{!t?.id||!(await N.fire({title:`Delete @${t.username}?`,text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Delete",cancelButtonText:"Cancel"})).isConfirmed||(await n.deleteById(t.id),await x({},!0),await N.fire("Deleted","User record removed.","success"))},G=async t=>{const e=t?.target?.files?.[0];if(!e||!s.value.id)return;const v=await te(e);await n.uploadAvatar(s.value.id,v),await n.fetchById(s.value.id),s.value.avatar=n.selectedUser?.avatar||s.value.avatar},H=async t=>{const e=t?.target?.files?.[0];if(!e||!s.value.id)return;const v=await oe(e);await n.uploadCover(s.value.id,v),await n.fetchById(s.value.id),s.value.cover=n.selectedUser?.cover||s.value.cover},F=h([]),P=h(!1),$=async t=>{try{P.value=!0;const e=await n.fetchUserClubs(t,{force:!0});F.value=Array.isArray(e)?e:[]}catch{F.value=[]}finally{P.value=!1}},J=t=>{t?.id&&j.push({name:"profile",params:{id:t.id}})};return(t,e)=>{const v=se("pending-click");return o(),i(C,null,[m(re,null,{default:g(()=>[m(ue,null,{default:g(()=>[m(ye,{icon:f(ce),title:"Users",main:""},{default:g(()=>[...e[21]||(e[21]=[b(" Manage users and access ",-1)])]),_:1},8,["icon"]),l("div",ke,[l("div",he,[c(l("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value.q=a),class:"border p-2 rounded w-full sm:flex-1 sm:min-w-0",placeholder:"Search username, name, email",onKeyup:e[1]||(e[1]=ae(a=>x({page:1}),["enter"]))},null,544),[[w,_.value.q]]),c(l("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>_.value.role=a),class:"border p-2 rounded w-full sm:flex-1 sm:min-w-0",onChange:e[3]||(e[3]=a=>x({page:1}))},[e[22]||(e[22]=l("option",{value:""},"All roles",-1)),(o(),i(C,null,E(V,a=>l("option",{key:a,value:a},p(a),9,Ce)),64))],544),[[A,_.value.role]]),c(l("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>_.value.is_active=a),class:"border p-2 rounded w-full sm:flex-1 sm:min-w-0",onChange:e[5]||(e[5]=a=>x({page:1}))},[(o(),i(C,null,E(T,a=>l("option",{key:a.label,value:a.value},"Active: "+p(a.label),9,Ae)),64))],544),[[A,_.value.is_active]])])]),l("div",Ue,[l("div",Ee,[e[23]||(e[23]=b("Total: ",-1)),l("b",null,p(B.value.total),1)]),l("div",Ve,[m(y,{icon:f(ve),color:"info",label:"Refresh",onClick:e[6]||(e[6]=a=>x({},!0))},null,8,["icon"]),m(y,{icon:f(me),color:"primary",label:"New User",onClick:L},null,8,["icon"])])]),f(n).error?(o(),S(ge,{key:0,color:"danger",class:"mb-3"},{default:g(()=>[b(p(f(n).error),1)]),_:1})):u("",!0),m(xe,{columns:M,data:B.value,loading:f(n).isLoading,onQueryChange:z},{"cell-avatar":g(({value:a})=>[l("div",Be,[a?(o(),i("img",{key:0,src:a,alt:"avatar",class:"w-full h-full object-cover",loading:"lazy"},null,8,Fe)):(o(),i("div",Pe,"N/A "))])]),"cell-is_active":g(({value:a})=>[m(q,{text:a?"Active":"Inactive",tone:D(a)},null,8,["text","tone"])]),"cell-twoFAEnabled":g(({value:a})=>[l("div",$e,[(o(),i("svg",Se,[l("path",{d:f(_e)},null,8,Ne)])),m(q,{text:a?"Enabled":"Disabled",tone:I(a)},null,8,["text","tone"])])]),"cell-actions":g(({row:a})=>[l("div",qe,[m(y,{icon:f(pe),color:"success",small:"",label:"Profile",onClick:U=>J(a)},null,8,["icon","onClick"]),m(y,{icon:f(fe),color:"primary",small:"",label:"View",onClick:U=>R(a)},null,8,["icon","onClick"]),m(y,{icon:f(be),color:"primary",small:"",label:"Edit",onClick:U=>O(a)},null,8,["icon","onClick"]),m(y,{icon:f(we),color:"danger",small:"",label:"Delete",onClick:U=>Y(a)},null,8,["icon","onClick"])])]),_:1},8,["data","loading"])]),_:1})]),_:1}),k.value?(o(),i("div",je,[l("div",Te,[l("div",De,[l("h2",Ie,p(r.value==="create"?"New User":r.value==="edit"?"Edit User":"View User"),1),m(y,{label:"Close",color:"secondary",outline:"",small:"",onClick:e[7]||(e[7]=a=>k.value=!1)})]),l("div",Me,[l("div",ze,[e[24]||(e[24]=l("label",{class:"block mb-1"},[b("Username "),l("span",{class:"text-red-500"},"*")],-1)),c(l("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.username=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},null,8,Le),[[w,s.value.username]]),d.value.username?(o(),i("p",Re,p(d.value.username),1)):u("",!0)]),l("div",Oe,[e[25]||(e[25]=l("label",{class:"block mb-1"},[b("Email "),l("span",{class:"text-red-500"},"*")],-1)),c(l("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.email=a),type:"email",class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},null,8,We),[[w,s.value.email]]),d.value.email?(o(),i("p",Qe,p(d.value.email),1)):u("",!0)]),r.value!=="view"?(o(),i(C,{key:0},[r.value==="create"?(o(),i("div",Ke,[e[26]||(e[26]=l("label",{class:"block mb-1"},[b("Password "),l("span",{class:"text-red-500"},"*")],-1)),c(l("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.password=a),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[w,s.value.password]]),d.value.password?(o(),i("p",Ye,p(d.value.password),1)):u("",!0)])):u("",!0),r.value==="create"?(o(),i("div",Ge,[e[27]||(e[27]=l("label",{class:"block mb-1"},[b("Confirm Password "),l("span",{class:"text-red-500"},"*")],-1)),c(l("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.confirm_password=a),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[w,s.value.confirm_password]]),d.value.confirm_password?(o(),i("p",He,p(d.value.confirm_password),1)):u("",!0)])):u("",!0),r.value==="edit"?(o(),i("div",Je,[e[28]||(e[28]=l("label",{class:"block mb-1"},"New Password (optional)",-1)),c(l("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.password=a),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2",placeholder:"Leave blank to keep current"},null,512),[[w,s.value.password]]),d.value.password?(o(),i("p",Xe,p(d.value.password),1)):u("",!0)])):u("",!0),r.value==="edit"&&s.value.password?(o(),i("div",Ze,[e[29]||(e[29]=l("label",{class:"block mb-1"},"Confirm New Password",-1)),c(l("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.confirm_password=a),type:"password",autocomplete:"new-password",class:"w-full border rounded px-2.5 py-2"},null,512),[[w,s.value.confirm_password]]),d.value.confirm_password?(o(),i("p",el,p(d.value.confirm_password),1)):u("",!0)])):u("",!0)],64)):u("",!0),l("div",null,[e[30]||(e[30]=l("label",{class:"block mb-1"},"First name",-1)),c(l("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.first_name=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},null,8,ll),[[w,s.value.first_name]])]),l("div",null,[e[31]||(e[31]=l("label",{class:"block mb-1"},"Last name",-1)),c(l("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.last_name=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},null,8,sl),[[w,s.value.last_name]])]),l("div",null,[e[32]||(e[32]=l("label",{class:"block mb-1"},[b("Role "),l("span",{class:"text-red-500"},"*")],-1)),c(l("select",{"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.role=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},[(o(),i(C,null,E(V,a=>l("option",{key:a,value:a},p(a),9,tl)),64))],8,al),[[A,s.value.role]]),d.value.role?(o(),i("p",ol,p(d.value.role),1)):u("",!0)]),l("div",null,[e[34]||(e[34]=l("label",{class:"block mb-1"},"Active",-1)),c(l("select",{"onUpdate:modelValue":e[17]||(e[17]=a=>s.value.is_active=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},[...e[33]||(e[33]=[l("option",{value:!0},"Yes",-1),l("option",{value:!1},"No",-1)])],8,il),[[A,s.value.is_active]])]),l("div",null,[e[36]||(e[36]=l("label",{class:"block mb-1"},"Two-Factor Auth",-1)),c(l("select",{"onUpdate:modelValue":e[18]||(e[18]=a=>s.value.twoFAEnabled=a),class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},[...e[35]||(e[35]=[l("option",{value:!0},"Enabled",-1),l("option",{value:!1},"Disabled",-1)])],8,rl),[[A,s.value.twoFAEnabled]])]),l("div",nl,[e[37]||(e[37]=l("label",{class:"block mb-1"},"Bio",-1)),c(l("textarea",{"onUpdate:modelValue":e[19]||(e[19]=a=>s.value.bio=a),rows:"2",class:"w-full border rounded px-2.5 py-2",disabled:r.value==="view"},null,8,dl),[[w,s.value.bio]])])]),s.value.id?(o(),i("div",ul,[e[40]||(e[40]=l("div",{class:"flex items-center justify-between mb-2"},[l("div",{class:"text-sm font-medium"},"Media")],-1)),l("div",cl,[l("div",null,[l("label",vl,[(o(),i("svg",ml,[l("path",{d:f(ne)},null,8,pl)])),e[38]||(e[38]=b(" Avatar ",-1))]),l("div",fl,[l("div",bl,[s.value.avatar?(o(),i("img",{key:0,src:s.value.avatar,class:"w-full h-full object-cover",loading:"lazy"},null,8,wl)):(o(),i("div",_l,"N/A "))]),l("input",{type:"file",accept:"image/*",disabled:r.value==="view",onChange:G},null,40,yl)])]),l("div",null,[l("label",xl,[(o(),i("svg",gl,[l("path",{d:f(de)},null,8,kl)])),e[39]||(e[39]=b(" Cover ",-1))]),l("div",hl,[l("div",Cl,[s.value.cover?(o(),i("img",{key:0,src:s.value.cover,class:"w-full h-full object-cover",loading:"lazy"},null,8,Al)):(o(),i("div",Ul,"N/A "))]),l("input",{type:"file",accept:"image/*",disabled:r.value==="view",onChange:H},null,40,El)])])])])):u("",!0),l("div",Vl,[m(y,{label:"Close",color:"secondary",outline:"",small:"",onClick:e[20]||(e[20]=a=>k.value=!1)}),r.value!=="view"?c((o(),S(y,{key:0,label:r.value==="edit"?"Save Changes":"Create User",color:"primary",small:""},null,8,["label"])),[[v,K]]):u("",!0)])])])):u("",!0)],64)}}};export{zl as default};
